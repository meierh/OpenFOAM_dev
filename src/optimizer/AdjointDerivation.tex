 % !TEX TS-program = pdflatex
% !TEX encoding = UTF-8 Unicode

\documentclass[10pt]{article} % use larger type; default would be 10pt

\usepackage[utf8]{inputenc} % set input encoding (not needed with XeLaTeX)

%%% PAGE DIMENSIONS
\usepackage{geometry} % to change the page dimensions
\geometry{a4paper} % or letterpaper (US) or a5paper or....
\geometry{margin=1.5cm} % for example, change the margins to 2 inches all round
% \geometry{landscape} % set up the page for landscape
%   read geometry.pdf for detailed page layout information


%%%PACKAGES%%%
\usepackage{subfig} % make it possible to include more than one captioned figure/table in a single float
\usepackage{amsmath} % mathematics

\usepackage{tikz}
\usetikzlibrary{trees}
\usepackage{algorithm2e}


\usepackage{multirow}
\usepackage{parallel,enumitem}

%%% HEADERS & FOOTERS
\usepackage{fancyhdr} % This should be set AFTER setting up the page geometry
\pagestyle{fancy} % options: empty , plain , fancy
\renewcommand{\headrulewidth}{0pt} % customise the layout...
\lhead{}\chead{}\rhead{}
\lfoot{}\cfoot{\thepage}\rfoot{}

%%% SECTION TITLE APPEARANCE
\usepackage{sectsty}
\allsectionsfont{\sffamily\mdseries\upshape} % (See the fntguide.pdf for font help)
% (This matches ConTeXt defaults)

%%% ToC (table of contents) APPEARANCE
\usepackage[nottoc,notlof,notlot]{tocbibind} % Put the bibliography in the ToC
\usepackage[titles,subfigure]{tocloft} % Alter the style of the Table of Contents
\renewcommand{\cftsecfont}{\rmfamily\mdseries\upshape}
\renewcommand{\cftsecpagefont}{\rmfamily\mdseries\upshape} % No bold!


%%% END Article customizations


\title{Equation derivation and algorithms}
\date{}
%\date{} % Activate to display a given date or no date (if empty),
         % otherwise the current date is printed 

\begin{document}
	\maketitle

\begin{center}
	\textbf{ Immersed Boundary Incompressible Navier Stokes with Nurbs Structure}\\
	Identify $\phi= \left(\vec{u},p,f_u,F_u,U_M,T_{\text{fluid}},f_{T_{\text{fluid}}},F_{T_{\text{fluid}}},T_{\text{fluid}_M},T_{\text{structure}},\vec{U}_\text{structure}\right)^T$\\
	Identify $\Gamma= \left((\vec{P}_{i})_0,...,(\vec{P}_{i})_{\lvert\lvert \text{Struts}\lvert\lvert-1},r_0,...,r_{\lvert\lvert \text{Struts}\lvert\lvert-1} \right)^T$\\
\begin{flushleft}
	Navier Stokes Equations:
\end{flushleft}
	$ \text{NS}_{\text{conti}} =- \nabla \cdot \vec{u} = 0$\\
	$ \text{NS}_{\text{mom}} = \frac{\partial \vec{u}}{\partial t} + (\vec{u} \cdot \nabla) \vec{u} - \frac{\mu}{\rho} \nabla \cdot \nabla \vec{u} + \frac{1}{\rho} \nabla p - f_u = 0$\\
	$\text{NS}_{\text{f}_u} = f_u (\vec{x}) - \sum_{X} F_u (X) \delta (\vec{x}-\vec{X}) = 0$\\
	$\text{NS}_{\text{F}_u} = F_u (\vec{X}) - \frac{\vec{U}_\text{structure} (\vec{X}) - U_M(\vec{X})}{\Delta t} = 0$\\
	$\text{NS}_{\text{U}_M} = U_M (\vec{X}) - \int u(\vec{x}) \delta(\vec{x}-\vec{X}) d \Omega= 0$\\
	$\text{NS}_{\text{T}_{\text{fluid}}} = \frac{\partial T_{\text{fluid}}}{\partial t} + \vec{u} \cdot \nabla T_{\text{fluid}} - \frac{\kappa}{\rho c_p} \nabla \cdot \nabla T_{\text{fluid}} - f_{\text{T}_{\text{fluid}}} = 0$\\
	$\text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} = f_{\text{T}_{\text{fluid}}} (\vec{x}) - \sum_{X} F_{\text{T}_{\text{fluid}}} (X) \delta (\vec{x}-\vec{X}) = 0$\\
	$\text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} = F_{\text{T}_{\text{fluid}}} (\vec{X}) - \frac{T_{\text{structure}} (\vec{X}) - {\text{T}_{\text{fluid}}}_M(\vec{X})}{\Delta t} = 0$\\
	$\text{NS}_{\text{T}_{\text{fluid}_M}} = \text{T}_{\text{fluid}_M} (\vec{X}) - \int {\text{T}_{\text{fluid}}}(\vec{x}) \delta(\vec{x}-\vec{X}) d \Omega= 0$\\
	$\text{FOUR}_{\text{T}_{\text{structure}}} = \rho c_p \frac{\partial T_{\text{structure}}}{\partial t} - \nabla \cdot (k\nabla T_{\text{structure}}) - \dot q$\\
	$\text{TIMO}_{\vec{U}} = ...$\\
\begin{flushleft}
	Navier Stokes Boundary Conditions:
\end{flushleft}
	$\vec{u}(x)=\vec{U}_{\text{Wall}} \quad \frac{\partial p}{\partial \vec{n}}(x)=0 \quad  T(x) = T_{\text{Wall}} \quad  \text{at } x \in X_{\text{Wall}}$\\
	$\vec{u}(x)=\vec{U}_{\text{inlet}} \quad \frac{\partial p}{\partial \vec{n}}(x)=0 \quad  T(x) = T_{\text{inlet}} \quad \text{at } x \in X_{\text{inlet}}$\\
	$\frac{\partial \vec{U}}{\partial \vec{n}}(x) = 0\quad p(x)=p_{\text{outlet}} \quad  \frac{\partial T}{\partial \vec{n}_{\text{outlet}}}(x) = 0 \quad \text{at } x \in X_{\text{outlet}}$\\
\begin{flushleft}
	Navier Stokes \& Structure Coupling Conditions:
\end{flushleft}
	$\vec{u}(x_{\text{solid}}\left(s,\theta\right))= \frac{\partial \vec{C}(s,t)}{\partial t} \quad \quad \text{at } s \in S_{\text{Strut}}$\\
	$ \vec{F}_{\text{solid}}(s) = \int_0^{2\pi} \tau_{\text{fluid}}(x_{\text{solid}}(s,\theta)) \cdot \vec{n} r d\theta \quad  \quad \text{at } s \in S_{\text{Strut}}$\\
	$ \pi r^2 \lambda_{\text{solid}} \frac{\partial T_{\text{solid}}(s)}{\partial s} = \int_0^{2\pi} \dot q_{\text{fluid}}(x_{\text{solid}}(s,\theta)) \cdot \vec{n} r d\theta \quad  \quad \text{at } s \in S_{\text{Strut}}$\\
	using\\
	$\tau_{\text{fluid}} = - p I + \mu \left(\nabla u + \nabla u ^T\right)$\\
	$\dot q_{\text{fluid}} = - \lambda_{\text{fluid}} \nabla T_{\text{fluid}}$\\
	$x_{\text{solid}}\left(s,\theta\right) = \vec{C}(s,t) + r\frac{\vec{C}(s,t)_{ss}}{\lvert \lvert \vec{C}(s,t)_{ss} \lvert \lvert_2}\sin(\theta) + r\frac{\vec{C}(s,t)_{ss} \times \vec{C}(s,t)_{s}}{\lvert \lvert \vec{C}(s,t)_{ss} \times \vec{C}(s,t)_{s} \lvert \lvert_2}\cos(\theta) $\\
\begin{flushleft}
	Structure Equations:
\end{flushleft}
	$X(s,...) = 0$\\
	$T_{\text{structure}}(s,...) =0$\\
\begin{flushleft}
	Structure Boundary Equation:
\end{flushleft}
	$\text{RB}_X(s,...) = 0$\\
	$\text{RB}_T(s,...) =0$\\
\end{center}

\begin{algorithm}[H]
	\SetAlgoLined
	\KwData{$\vec{u}$,$p$,$f_u$,$U_M$,$U_\text{structure}$,$F_u$}
	\KwData{$T_{\text{fluid}}$,$\text{T}_{\text{fluid}_M}$,$T_\text{structure}$,$f_{\text{T}_{\text{fluid}}}$}
	\For{timestep}
	{
		\While{not converged}
		{
			Solve for $\vec{u}$: $\frac{\partial \vec{u}}{\partial t} + (\vec{u} \cdot \nabla) \vec{u} - \frac{\mu}{\rho} \nabla \cdot \nabla \vec{u} = - \frac{1}{\rho} \nabla p + f_u$ \quad on $\Omega$\\
			Compute : $U_M (\vec{X}) = \int u(\vec{x}) \delta(\vec{x}-\vec{X}) d \Omega$ \quad on $X$\\
			Compute : $U_{\text{structure}} (\vec{X}) = \frac{d \vec{X}_{\text{structure}}}{dt}$ \quad on $X$\\
			Compute : $F_u (\vec{X}) = \frac{\vec{U}_\text{structure} (\vec{X}) - U_M(\vec{X})}{\Delta t}$ \quad on $X$\\
			Solve for $\vec{X}_\text{structure}$: $\text{StructureSolver}(F_u)$ \quad on $X$\\
			Compute : $f_u (\vec{x}) = \sum_{X} F_u (X) \delta (\vec{x}-\vec{X})$ \quad on $\Omega$\\
			Solve for $p$: $\text{Pressure Correction}(- \nabla \cdot \vec{u} = 0)$ \quad on $\Omega$\\
		}
		\While{not converged}
		{
			Solve for $T_{\text{fluid}}$: $\frac{\partial T_{\text{fluid}}}{\partial t} + \vec{u} \cdot \nabla T_{\text{fluid}} - \frac{\kappa}{\rho c_p} \nabla \cdot \nabla T_{\text{fluid}} = f_{\text{T}_{\text{fluid}}}$ \quad on $\Omega$\\
			Compute : $\text{T}_{\text{fluid}_M} (\vec{X}) = \int {\text{T}_{\text{fluid}}}(\vec{x}) \delta(\vec{x}-\vec{X}) d \Omega$  \quad on $X$\\
			Compute : $F_{\text{T}_{\text{fluid}}} (\vec{X}) = \frac{T_{\text{structure}} (\vec{X}) - {\text{T}_{\text{fluid}}}_M(\vec{X})}{\Delta t}$ \quad on $X$\\
			Solve for $T_\text{structure}$: $\text{StructureHeatSolver}(F_{\text{T}_{\text{fluid}}})$ \quad on $X$\\
			Compute : $f_{\text{T}_{\text{fluid}}} (\vec{x}) = \sum_{X} F_{\text{T}_{\text{fluid}}} (X) \delta (\vec{x}-\vec{X})$ \quad on $\Omega$\\
		}
	}
	\caption{TFSI solution algorithm}
\end{algorithm}

\begin{algorithm}[H]
	\SetAlgoLined
	\KwData{$\vec{u}$,$\vec{\phi}$,$p$,$f_u$,$U_M$,$U_\text{structure}$,$F_u$}
	\KwData{$T_{\text{fluid}}$,$\text{T}_{\text{fluid}_M}$,$T_\text{structure}$,$f_{\text{T}_{\text{fluid}}}$}
	\For{timestep}
	{
		\While{not converged}
		{
			Set: $\text{UEqn} = \frac{\partial \vec{u}}{\partial t} + (\vec{\phi} \cdot \nabla) \vec{u} - \frac{\mu}{\rho} \nabla \cdot \nabla \vec{u} - f_u$\\
			Compute: Equation under-relaxation($\text{UEqn}$) (Notes on Computational Fluid Dynamics p.157)\\
			Constrain $(\text{UEqn})$\\
			Solve for $\vec{u}$: $\text{UEqn} = - \frac{1}{\rho} \nabla p $ \quad on $\Omega$\\
			Constrain $(\vec{u})$\\
			\quad \\
			Compute : $U_M (\vec{X}) = \int u(\vec{x}) \delta(\vec{x}-\vec{X}) d \Omega$ \quad on $X$\\
			Compute : $U_{\text{structure}} (\vec{X}) = \frac{d \vec{X}_{\text{structure}}}{dt}$ \quad on $X$\\
			Compute : $F_u (\vec{X}) = \frac{\vec{U}_\text{structure} (\vec{X}) - U_M(\vec{X})}{\Delta t}$ \quad on $X$\\
			Solve for $\vec{X}_\text{structure}$: $\text{StructureSolver}(F_u)$ \quad on $X$\\
			Compute : $f_u (\vec{x}) = \sum_{X} F_u (X) \delta (\vec{x}-\vec{X})$ \quad on $\Omega$\\
			\quad \\
			\While{pressureCorrection loop}
			{
				Set VolScalarField $\text{rAU} =  \frac{1}{\text{diag}(\text{UEqn})}$\\
				Set VolVectorField $\text{HbyA} =  \text{rAU}*\text{offDiag}(\text{UEqn})$\\
				ConstrainOnBoundary $(\text{HbyA},\vec{u},p)$\\
				\quad Set FaceVectorField $\text{HbyA}_{\text{flux}} =  \text{Compute flux on faces}(\text{HbyA})$\\
				\quad Set FaceScalarField $\text{rAU}_{\text{face}} =  \text{interpolate}(\text{rAU})$\\
				Set FaceScalarField $\text{phiHbyA} = \text{HbyA}_{\text{flux}} + \text{rAU}_{\text{face}}*\text{ddtCorr}(\vec{u},\vec{\phi}) $\\
				Set VolScalarField $\text{rAtU} = \text{rAU}$\\
				\If{pimple.consistent}
				{
					Compute $\text{rAtU} =  \frac{1}{max\left[(\frac{1}{\text{rAU}}) - \text{offDiag}(\text{UEqn})/\text{Vol} , \frac{0.1}{\text{rAU}}\right]} $\\
					Compute $\text{phiHbyA} += \text{interpolate}(\text{rAtU}-\text{rAU})*\text{surfaceGrad}(p)*\text{faceVolume}$\\
					Compute $\text{HbyA} -=  \left(\text{rAU}-\text{rAtU}\right)*\text{grad}(p)$\\
				}
				ConstrainPressure $(p,\vec{u},\text{phiHbyA},\text{rAtU})$\\
				\While{pimple.correctNonOrthogonal}
				{
					Set: $\text{pEqn} = \nabla \cdot \left(\text{rAtU} * \nabla \vec{u}\right)-\nabla \cdot \text{phiHbyA}$\\
					$\text{pEqn}.$setReference()\\
					$\text{pEqn}.$solve()\\
				}
				\If{pimple.consistent}
				{
					$\vec{\phi} = \text{phiHbyA} - \text{pEqn}$.flux()\\
				}
				$p.$relax()\\
				Compute: $\vec{u} = \text{HbyA} - \text{rAtU}*\text{grad}(p)$\\
				CorrectBoundaryConditions($\vec{u}$)\\
				Constrain($\vec{u}$)
			}
		}
		\While{not converged}
		{
			Set: $\text{TEqn} = \frac{\partial T_{\text{fluid}}}{\partial t} + \vec{\phi} \cdot \nabla T_{\text{fluid}} - \frac{\kappa}{\rho c_p} \nabla \cdot \nabla T_{\text{fluid}}$\\
			Solve for $T_{\text{fluid}}$: $\text{TEqn} = f_{\text{T}_{\text{fluid}}}$ \quad on $\Omega$\\
			\quad \\
			Compute : $\text{T}_{\text{fluid}_M} (\vec{X}) = \int {\text{T}_{\text{fluid}}}(\vec{x}) \delta(\vec{x}-\vec{X}) d \Omega$  \quad on $X$\\
			Compute : $F_{\text{T}_{\text{fluid}}} (\vec{X}) = \frac{T_{\text{structure}} (\vec{X}) - {\text{T}_{\text{fluid}}}_M(\vec{X})}{\Delta t}$ \quad on $X$\\
			Solve for $T_\text{structure}$: $\text{StructureHeatSolver}(F_{\text{T}_{\text{fluid}}})$ \quad on $X$\\
			Compute : $f_{\text{T}_{\text{fluid}}} (\vec{x}) = \sum_{X} F_{\text{T}_{\text{fluid}}} (X) \delta (\vec{x}-\vec{X})$ \quad on $\Omega$\\
		}
	}
	\caption{Detailed OpenFOAM Pimple TFSI solution algorithm}
\end{algorithm}

\newpage
\begin{center}
	\textbf{Optimization Immersed Boundary Incompressible Navier Stokes with Nurbs Structure}
\begin{flushleft}
	Optimization problem
\end{flushleft}	
	minimize $J(\Gamma,\phi)$\\
	subject to $\text{NS}(\phi) = 0$
\begin{flushleft}
	Lagrangian formulation
\end{flushleft}	
	$L = J + \int_{\Omega} \vec{\lambda} \cdot \text{NS}(\phi)  d\Omega$\\
	$\delta L = \delta_\Gamma L + \delta_\phi L$\\
\begin{flushleft}
	Variational Immersed Boundary Navier Stokes
\end{flushleft}
\begin{flushleft}
	$\delta \vec{u} \text{NS}:$
\end{flushleft}
	$\delta \vec{u} \text{NS}_{\text{mom}} = (\vec{u}\cdot\nabla) \delta{\vec{u}} + (\delta{\vec{u}}\cdot\nabla)\vec{u}-\frac{\mu}{\rho} \Delta \delta{\vec{u}}$\\
	$\delta \vec{u} \text{NS}_{\text{conti}} = - \nabla \cdot \delta\vec{u}$\\
	$\delta \vec{u} \text{NS}_{\text{f}_u} = 0$\\
	$\delta \vec{u} \text{NS}_{\text{F}_u} = 0$\\
	$\delta \vec{u} \text{NS}_{\text{U}_M} =  - \int \delta u(\vec{x}) \delta(\vec{x}-\vec{X}) d \Omega$\\
	$\delta \vec{u} \text{NS}_{\text{T}_{\text{fluid}}} = \delta\vec{u} \cdot \nabla T_{\text{fluid}}$\\
	$\delta \vec{u} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} = 0$\\
	$\delta \vec{u} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} = 0$\\
	$\delta \vec{u} \text{NS}_{\text{T}_{\text{fluid}_M}} = 0$\\
	$\delta \vec{u} \text{FOUR}_{\text{T}_{\text{structure}}} = 0$\\
	$\delta \vec{u} \text{TIMO}_{\vec{U}} = 0$\\
\begin{flushleft}
	$\delta p \text{NS}:$
\end{flushleft}
	$\delta p \text{NS}_{\text{mom}} =  \frac{1}{\rho} \nabla \delta p$\\
	$\delta p \text{NS}_{\text{conti}} = 0$\\
	$\delta p \text{NS}_{\text{f}_u} = 0$\\
	$\delta p \text{NS}_{\text{F}_u} = 0$\\
	$\delta p \text{NS}_{\text{U}_M} = 0$\\
	$\delta p \text{NS}_{\text{T}_{\text{fluid}}} = 0$\\
	$\delta p \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} = 0$\\
	$\delta p \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} = 0$\\
	$\delta p \text{NS}_{\text{T}_{\text{fluid}_M}} = 0$\\
	$\delta p \text{FOUR}_{\text{T}_{\text{structure}}} = 0$\\
	$\delta p \text{TIMO}_{\vec{U}} = 0$\\
\begin{flushleft}
	$\delta f_u \text{NS}:$
\end{flushleft}
	$\delta f_u \text{NS}_{\text{mom}} =  -\delta f_u$\\
	$\delta f_u \text{NS}_{\text{conti}} = 0$\\
	$\delta f_u \text{NS}_{\text{f}_u} = \delta f_u$\\
	$\delta f_u \text{NS}_{\text{F}_u} = 0$\\
	$\delta f_u \text{NS}_{\text{U}_M} = 0$\\
	$\delta f_u \text{NS}_{\text{T}_{\text{fluid}}} = 0$\\
	$\delta f_u \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} = 0$\\
	$\delta f_u \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} = 0$\\
	$\delta f_u \text{NS}_{\text{T}_{\text{fluid}_M}} = 0$\\
	$\delta f_u \text{FOUR}_{\text{T}_{\text{structure}}} = 0$\\
	$\delta f_u \text{TIMO}_{\vec{U}} = 0$\\
\begin{flushleft}
	$\delta F_u \text{NS}:$
\end{flushleft}
	$\delta F_u \text{NS}_{\text{mom}} =  0$\\
	$\delta F_u \text{NS}_{\text{conti}} = 0$\\
	$\delta F_u \text{NS}_{\text{f}_u} = -\sum_X \delta F_u \delta (\vec{x}-\vec{X})$\\
	$\delta F_u \text{NS}_{\text{F}_u} = \delta F_u$\\
	$\delta F_u \text{NS}_{\text{U}_M} = 0$\\
	$\delta F_u \text{NS}_{\text{T}_{\text{fluid}}} = 0$\\
	$\delta F_u \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} = 0$\\
	$\delta F_u \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} = 0$\\
	$\delta F_u \text{NS}_{\text{T}_{\text{fluid}_M}} = 0$\\
	$\delta F_u \text{FOUR}_{\text{T}_{\text{structure}}} = 0$\\
	$\delta F_u \text{TIMO}_{\vec{U}} = ...$\\
\begin{flushleft}
	$\delta U_M \text{NS}:$
\end{flushleft}
	$\delta U_M \text{NS}_{\text{mom}} =  0$\\
	$\delta U_M \text{NS}_{\text{conti}} = 0$\\
	$\delta U_M \text{NS}_{\text{f}_u} = 0$\\
	$\delta U_M \text{NS}_{\text{F}_u} = \frac{\delta U_M}{\Delta t}$\\
	$\delta U_M \text{NS}_{\text{U}_M} = \delta U_M$\\
	$\delta U_M \text{NS}_{\text{T}_{\text{fluid}}} = 0$\\
	$\delta U_M \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} = 0$\\
	$\delta U_M \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} = 0$\\
	$\delta U_M \text{NS}_{\text{T}_{\text{fluid}_M}} = 0$\\
	$\delta U_M \text{FOUR}_{\text{T}_{\text{structure}}} = 0$\\
	$\delta U_M \text{TIMO}_{\vec{U}} = 0$\\
\begin{flushleft}
	$\delta T_{\text{fluid}} \text{NS}:$
\end{flushleft}
	$\delta T_{\text{fluid}} \text{NS}_{\text{mom}} =  0$\\
	$\delta T_{\text{fluid}} \text{NS}_{\text{conti}} = 0$\\
	$\delta T_{\text{fluid}} \text{NS}_{\text{f}_u} = 0$\\
	$\delta T_{\text{fluid}} \text{NS}_{\text{F}_u} = 0$\\
	$\delta T_{\text{fluid}} \text{NS}_{\text{U}_M} = 0$\\
	$\delta T_{\text{fluid}} \text{NS}_{\text{T}_{\text{fluid}}} =  \vec{u} \cdot \nabla \delta T_{\text{fluid}} - \frac{\kappa}{\rho c_p} \nabla \cdot \nabla \delta T_{\text{fluid}}$\\
	$\delta T_{\text{fluid}} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} = 0$\\
	$\delta T_{\text{fluid}} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} = 0$\\
	$\delta T_{\text{fluid}} \text{NS}_{\text{T}_{\text{fluid}_M}} = -\int \delta T_{\text{fluid}} \delta (\vec{x}-\vec{X}) d\Omega$\\
	$\delta T_{\text{fluid}} \text{FOUR}_{\text{T}_{\text{structure}}} = 0$\\
	$\delta T_{\text{fluid}} \text{TIMO}_{\vec{U}} = 0$\\
\begin{flushleft}
	$\delta f_{\text{T}_{\text{fluid}}} \text{NS}:$
\end{flushleft}
	$\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{mom}} =  0$\\
	$\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{conti}} = 0$\\
	$\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{f}_u} = 0$\\
	$\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{F}_u} = 0$\\
	$\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{U}_M} = 0$\\
	$\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{T}_{\text{fluid}}} = -\delta f_{\text{T}_{\text{fluid}}}$\\
	$\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} = \delta f_{\text{T}_{\text{fluid}}}$\\
	$\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} = 0$\\
	$\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{T}_{\text{fluid}_M}} = 0$\\
	$\delta f_{\text{T}_{\text{fluid}}} \text{FOUR}_{\text{T}_{\text{structure}}} = 0$\\
	$\delta f_{\text{T}_{\text{fluid}}} \text{TIMO}_{\vec{U}} = 0$\\
\begin{flushleft}
	$\delta F_{\text{T}_{\text{fluid}}} \text{NS}:$
\end{flushleft}
	$\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{mom}} = 0$\\
	$\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{conti}} = 0$\\
	$\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{f}_u} = 0$\\
	$\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{F}_u} = 0$\\
	$\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{U}_M} = 0$\\
	$\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{T}_{\text{fluid}}} = 0 $\\
	$\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} = -\sum_X \delta F_{\text{T}_{\text{fluid}}} \delta (\vec{x}-\vec{X})$\\
	$\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} = \delta F_{\text{T}_{\text{fluid}}}$\\
	$\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{T}_{\text{fluid}_M}} = 0$\\
	$\delta F_{\text{T}_{\text{fluid}}} \text{FOUR}_{\text{T}_{\text{structure}}} = ...$\\
	$\delta F_{\text{T}_{\text{fluid}}} \text{TIMO}_{\vec{U}} = 0$\\
\begin{flushleft}
	$\delta T_{\text{fluid}_M} \text{NS}:$
\end{flushleft}
	$\delta T_{\text{fluid}_M} \text{NS}_{\text{mom}} =  0$\\
	$\delta T_{\text{fluid}_M} \text{NS}_{\text{conti}} = 0$\\
	$\delta T_{\text{fluid}_M} \text{NS}_{\text{f}_u} = 0$\\
	$\delta T_{\text{fluid}_M} \text{NS}_{\text{F}_u} = 0$\\
	$\delta T_{\text{fluid}_M} \text{NS}_{\text{U}_M} = 0$\\
	$\delta T_{\text{fluid}_M} \text{NS}_{\text{T}_{\text{fluid}}} = 0$\\
	$\delta T_{\text{fluid}_M} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} = 0$\\
	$\delta T_{\text{fluid}_M} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} = \frac{\delta T_{\text{fluid}_M}}{\Delta t}$\\
	$\delta T_{\text{fluid}_M} \text{NS}_{\text{T}_{\text{fluid}_M}} = \delta T_{\text{fluid}_M}$\\
	$\delta T_{\text{fluid}_M} \text{FOUR}_{\text{T}_{\text{structure}}} = 0$\\
	$\delta T_{\text{fluid}_M} \text{TIMO}_{\vec{U}} = 0$\\
\begin{flushleft}
	$\delta T_{\text{structure}} \text{NS}:$
\end{flushleft}
	$\delta T_{\text{structure}} \text{NS}_{\text{mom}} = 0$\\
	$\delta T_{\text{structure}} \text{NS}_{\text{conti}} = 0$\\
	$\delta T_{\text{structure}} \text{NS}_{\text{f}_u} = 0$\\
	$\delta T_{\text{structure}} \text{NS}_{\text{F}_u} = 0$\\
	$\delta T_{\text{structure}} \text{NS}_{\text{U}_M} = 0$\\
	$\delta T_{\text{structure}} \text{NS}_{\text{T}_{\text{fluid}}} = 0 $\\
	$\delta T_{\text{structure}} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} = 0$\\
	$\delta T_{\text{structure}} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} = -\frac{\delta T_{\text{structure}}}{\Delta t}$\\
	$\delta T_{\text{structure}} \text{NS}_{\text{T}_{\text{fluid}_M}} = 0$\\
	$\delta T_{\text{structure}} \text{FOUR}_{\text{T}_{\text{structure}}} = ...$\\
	$\delta T_{\text{structure}} \text{TIMO}_{\vec{U}} = 0$\\
\begin{flushleft}
	$\delta \vec{U}_{\text{structure}} \text{NS}:$
\end{flushleft}
	$\delta \vec{U}_{\text{structure}} \text{NS}_{\text{mom}} =  0$\\
	$\delta \vec{U}_{\text{structure}} \text{NS}_{\text{conti}} = 0$\\
	$\delta \vec{U}_{\text{structure}} \text{NS}_{\text{f}_u} = 0$\\
	$\delta \vec{U}_{\text{structure}} \text{NS}_{\text{F}_u} = -\frac{\delta \vec{U}_{\text{structure}}}{\Delta t}$\\
	$\delta \vec{U}_{\text{structure}} \text{NS}_{\text{U}_M} = 0$\\
	$\delta \vec{U}_{\text{structure}} \text{NS}_{\text{T}_{\text{fluid}}} = 0$\\
	$\delta \vec{U}_{\text{structure}} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} = 0$\\
	$\delta \vec{U}_{\text{structure}} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} = 0$\\
	$\delta \vec{U}_{\text{structure}} \text{NS}_{\text{T}_{\text{fluid}_M}} = 0$\\
	$\delta \vec{U}_{\text{structure}} \text{FOUR}_{\text{T}_{\text{structure}}} = 0$\\
	$\delta \vec{U}_{\text{structure}} \text{TIMO}_{\vec{U}} = ...$\\
\newpage
\begin{flushleft}
	Variational Immersed Boundary Navier Stokes
\end{flushleft}
$\delta_\phi L = \delta_\phi J + \delta_\phi \int_{\Omega \cup X} \vec{\lambda} \cdot \text{NS}(\phi)
	d\Omega\cup X $\\
$\delta_\phi L = \delta \vec{u} J + \delta p J + \delta f_u J + \delta F_u J + \delta U_M J +
	\delta T_{\text{fluid}} J + \delta f_{T_{\text{fluid}}} J + \delta F_{T_{\text{fluid}}} J + \delta T_{\text{fluid}_M} J +$\\
    $\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		\delta \vec{u} \text{NS}_{\text{mom}} \\
		\delta \vec{u} \text{NS}_{\text{conti}}\\
		\delta \vec{u} \text{NS}_{\text{f}_u} \\
		\delta \vec{u} \text{NS}_{\text{F}_u} \\
		\delta \vec{u} \text{NS}_{\text{U}_M} \\
		\delta \vec{u} \text{NS}_{\text{T}_{\text{fluid}}} \\
		\delta \vec{u} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}}\\
		\delta \vec{u} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}}\\
		\delta \vec{u} \text{NS}_{\text{T}_{\text{fluid}_M}}\\
		\delta \vec{u} \text{FOUR}_{\text{T}_{\text{structure}}}\\
		\delta \vec{u} \text{TIMO}_{\vec{U}}\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		\delta p \text{NS}_{\text{mom}} \\
		\delta p \text{NS}_{\text{conti}}\\
		\delta p \text{NS}_{\text{f}_u} \\
		\delta p \text{NS}_{\text{F}_u} \\
		\delta p \text{NS}_{\text{U}_M} \\
		\delta p \text{NS}_{\text{T}_{\text{fluid}}} \\
		\delta p \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}}\\
		\delta p \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}}\\
		\delta p \text{NS}_{\text{T}_{\text{fluid}_M}}\\
		\delta p \text{FOUR}_{\text{T}_{\text{structure}}}\\
		\delta p \text{TIMO}_{\vec{U}}\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		\delta f_u \text{NS}_{\text{mom}} \\
		\delta f_u \text{NS}_{\text{conti}}\\
		\delta f_u \text{NS}_{\text{f}_u} \\
		\delta f_u \text{NS}_{\text{F}_u} \\
		\delta f_u \text{NS}_{\text{U}_M} \\
		\delta f_u \text{NS}_{\text{T}_{\text{fluid}}} \\
		\delta f_u \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}}\\
		\delta f_u \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}}\\
		\delta f_u \text{NS}_{\text{T}_{\text{fluid}_M}}\\
		\delta f_u \text{FOUR}_{\text{T}_{\text{structure}}}\\
		\delta f_u \text{TIMO}_{\vec{U}}\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		\delta F_u \text{NS}_{\text{mom}} \\
		\delta F_u \text{NS}_{\text{conti}}\\
		\delta F_u \text{NS}_{\text{f}_u} \\
		\delta F_u \text{NS}_{\text{F}_u} \\
		\delta F_u \text{NS}_{\text{U}_M} \\
		\delta F_u \text{NS}_{\text{T}_{\text{fluid}}} \\
		\delta F_u \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}}\\
		\delta F_u \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}}\\
		\delta F_u \text{NS}_{\text{T}_{\text{fluid}_M}}\\
		\delta F_u \text{FOUR}_{\text{T}_{\text{structure}}}\\
		\delta F_u \text{TIMO}_{\vec{U}}\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		\delta U_M \text{NS}_{\text{mom}} \\
		\delta U_M \text{NS}_{\text{conti}}\\
		\delta U_M \text{NS}_{\text{f}_u} \\
		\delta U_M \text{NS}_{\text{F}_u} \\
		\delta U_M \text{NS}_{\text{U}_M} \\
		\delta U_M \text{NS}_{\text{T}_{\text{fluid}}} \\
		\delta U_M \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}}\\
		\delta U_M \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}}\\
		\delta U_M \text{NS}_{\text{T}_{\text{fluid}_M}}\\
		\delta U_M \text{FOUR}_{\text{T}_{\text{structure}}}\\
		\delta U_M \text{TIMO}_{\vec{U}}\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		\delta T_{\text{fluid}} \text{NS}_{\text{mom}} \\
		\delta T_{\text{fluid}} \text{NS}_{\text{conti}}\\
		\delta T_{\text{fluid}} \text{NS}_{\text{f}_u} \\
		\delta T_{\text{fluid}} \text{NS}_{\text{F}_u} \\
		\delta T_{\text{fluid}} \text{NS}_{\text{U}_M} \\
		\delta T_{\text{fluid}} \text{NS}_{\text{T}_{\text{fluid}}} \\
		\delta T_{\text{fluid}} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}}\\
		\delta T_{\text{fluid}} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}}\\
		\delta T_{\text{fluid}} \text{NS}_{\text{T}_{\text{fluid}_M}}\\
		\delta T_{\text{fluid}} \text{FOUR}_{\text{T}_{\text{structure}}}\\
		\delta T_{\text{fluid}} \text{TIMO}_{\vec{U}}\\
	\end{pmatrix}
	d\Omega \cup X + $\\

		$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{mom}} \\
		\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{conti}}\\
		\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{f}_u} \\
		\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{F}_u} \\
		\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{U}_M} \\
		\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{T}_{\text{fluid}}} \\
		\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}}\\
		\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}}\\
		\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{T}_{\text{fluid}_M}}\\
		\delta f_{\text{T}_{\text{fluid}}} \text{FOUR}_{\text{T}_{\text{structure}}}\\
		\delta f_{\text{T}_{\text{fluid}}} \text{TIMO}_{\vec{U}}\\
	\end{pmatrix}
	d\Omega \cup X + $\\

		$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{mom}} \\
		\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{conti}}\\
		\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{f}_u} \\
		\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{F}_u} \\
		\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{U}_M} \\
		\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{T}_{\text{fluid}}} \\
		\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}}\\
		\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}}\\
		\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{T}_{\text{fluid}_M}}\\
		\delta F_{\text{T}_{\text{fluid}}} \text{FOUR}_{\text{T}_{\text{structure}}}\\
		\delta F_{\text{T}_{\text{fluid}}} \text{TIMO}_{\vec{U}}\\
	\end{pmatrix}
	d\Omega \cup X + $\\

		$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		\delta T_{\text{fluid}_M} \text{NS}_{\text{mom}} \\
		\delta T_{\text{fluid}_M} \text{NS}_{\text{conti}}\\
		\delta T_{\text{fluid}_M} \text{NS}_{\text{f}_u} \\
		\delta T_{\text{fluid}_M} \text{NS}_{\text{F}_u} \\
		\delta T_{\text{fluid}_M} \text{NS}_{\text{U}_M} \\
		\delta T_{\text{fluid}_M} \text{NS}_{\text{T}_{\text{fluid}}} \\
		\delta T_{\text{fluid}_M} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}}\\
		\delta T_{\text{fluid}_M} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}}\\
		\delta T_{\text{fluid}_M} \text{NS}_{\text{T}_{\text{fluid}_M}}\\
		\delta T_{\text{fluid}_M} \text{FOUR}_{\text{T}_{\text{structure}}}\\
		\delta T_{\text{fluid}_M} \text{TIMO}_{\vec{U}}\\
	\end{pmatrix}
	d\Omega \cup X +$\\
	
	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		\delta T_{\text{structure}} \text{NS}_{\text{mom}} \\
		\delta T_{\text{structure}} \text{NS}_{\text{conti}}\\
		\delta T_{\text{structure}} \text{NS}_{\text{f}_u} \\
		\delta T_{\text{structure}} \text{NS}_{\text{F}_u} \\
		\delta T_{\text{structure}} \text{NS}_{\text{U}_M} \\
		\delta T_{\text{structure}} \text{NS}_{\text{T}_{\text{fluid}}} \\
		\delta T_{\text{structure}} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}}\\
		\delta T_{\text{structure}} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}}\\
		\delta T_{\text{structure}} \text{NS}_{\text{T}_{\text{fluid}_M}}\\
		\delta T_{\text{structure}} \text{FOUR}_{\text{T}_{\text{structure}}}\\
		\delta T_{\text{structure}} \text{TIMO}_{\vec{U}}\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		\delta \vec{U}_{\text{structure}} \text{NS}_{\text{mom}} \\
		\delta \vec{U}_{\text{structure}} \text{NS}_{\text{conti}}\\
		\delta \vec{U}_{\text{structure}} \text{NS}_{\text{f}_u} \\
		\delta \vec{U}_{\text{structure}} \text{NS}_{\text{F}_u} \\
		\delta \vec{U}_{\text{structure}} \text{NS}_{\text{U}_M} \\
		\delta \vec{U}_{\text{structure}} \text{NS}_{\text{T}_{\text{fluid}}} \\
		\delta \vec{U}_{\text{structure}} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}}\\
		\delta \vec{U}_{\text{structure}} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}}\\
		\delta \vec{U}_{\text{structure}} \text{NS}_{\text{T}_{\text{fluid}_M}}\\
		\delta \vec{U}_{\text{structure}} \text{FOUR}_{\text{T}_{\text{structure}}}\\
		\delta \vec{U}_{\text{structure}} \text{TIMO}_{\vec{U}}\\
	\end{pmatrix}
	d\Omega \cup X $\\
	
	$=0$\\
	
	\newpage
	
	$\delta_\phi L = \delta \vec{u} J + \delta p J + \delta f_u J + \delta F_u J + \delta U_M J +
	\delta T_{\text{fluid}} J + \delta f_{T_{\text{fluid}}} J + \delta F_{T_{\text{fluid}}} J + \delta T_{\text{fluid}_M} J +$\\
	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		\delta \vec{u} \text{NS}_{\text{mom}} \\
		\delta \vec{u} \text{NS}_{\text{conti}}\\
		0 \\
		0 \\
		\delta \vec{u} \text{NS}_{\text{U}_M} \\
		\delta \vec{u} \text{NS}_{\text{T}_{\text{fluid}}} \\
		0\\
		0\\
		0\\
		0\\
		0\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		\delta p \text{NS}_{\text{mom}} \\
		0\\
		0 \\
		0 \\
		0 \\
		0 \\
		0\\
		0\\
		0\\
		0\\
		0\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		\delta f_u \text{NS}_{\text{mom}} \\
		0\\
		\delta f_u \text{NS}_{\text{f}_u} \\
		0 \\
		0 \\
		0 \\
		0\\
		0\\
		0\\
		0\\
		0\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		0\\
		0\\
		\delta F_u \text{NS}_{\text{f}_u} \\
		\delta F_u \text{NS}_{\text{F}_u} \\
		0\\
		0\\
		0\\
		0\\
		0\\
		0\\
		\delta F_u \text{TIMO}_{\vec{U}}\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		0 \\
		0\\
		0 \\
		\delta U_M \text{NS}_{\text{F}_u} \\
		\delta U_M \text{NS}_{\text{U}_M} \\
		0 \\
		0\\
		0\\
		0\\
		0\\
		\delta F_u \text{TIMO}_{\vec{U}}\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		0 \\
		0\\
		0 \\
		0 \\
		0 \\
		\delta T_{\text{fluid}} \text{NS}_{\text{T}_{\text{fluid}}} \\
		0\\
		0\\
		\delta T_{\text{fluid}} \text{NS}_{\text{T}_{\text{fluid}_M}}\\
		0\\
		0\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		0 \\
		0\\
		0 \\
		0 \\
		0 \\
		\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{T}_{\text{fluid}}} \\
		\delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}}\\
		0\\
		0\\
		0\\
		0\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		0 \\
		0\\
		0 \\
		0 \\
		0 \\
		0 \\
		\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}}\\
		\delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}}\\
		0\\
		\delta F_{\text{T}_{\text{fluid}}} \text{FOUR}_{\text{T}_{\text{structure}}}\\
		0\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		0\\
		0\\
		0 \\
		0\\
		0 \\
		0\\
		0\\
		\delta T_{\text{fluid}_M} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}}\\
		\delta T_{\text{fluid}_M} \text{NS}_{\text{T}_{\text{fluid}_M}}\\
		0\\
		0\\
	\end{pmatrix}
	d\Omega \cup X + $\\
	
	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		0\\
		0\\
		0\\
		0\\
		0\\
		0\\
		0\\
		\delta T_{\text{structure}} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} \\
		0\\
		\delta T_{\text{structure}} \text{FOUR}_{\text{T}_{\text{structure}}}\\
		0\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		0 \\
		0 \\
		0 \\
		\delta \vec{U}_{\text{structure}} \text{NS}_{\text{F}_u} \\
		0 \\
		0 \\
		0 \\
		0 \\
		0 \\
		0 \\
		\delta \vec{U}_{\text{structure}} \text{TIMO}_{\vec{U}}\\
	\end{pmatrix}
	d\Omega \cup X $\\

	$=0$\\

	\newpage

	$\delta_\phi L = \delta \vec{u} J + \delta p J + \delta f_u J + \delta F_u J + \delta U_M J +
	\delta T_{\text{fluid}} J + \delta f_{T_{\text{fluid}}} J + \delta F_{T_{\text{fluid}}} J + \delta T_{\text{fluid}_M} J +$\\
	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		(\vec{u}\cdot\nabla) \delta{\vec{u}} + (\delta{\vec{u}}\cdot\nabla)\vec{u}-\frac{\mu}{\rho} \Delta \delta{\vec{u}} \\
		- \nabla \cdot \delta\vec{u}\\
		0 \\
		0 \\
		- \int \delta u(\vec{x}) \delta(\vec{x}-\vec{X}) d \Omega \\
		(\delta\vec{u} \cdot \nabla) T_{\text{fluid}} \\
		0\\
		0\\
		0\\
		0\\
		0\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		\frac{1}{\rho} \nabla \delta p \\
		0\\
		0 \\
		0 \\
		0 \\
		0 \\
		0\\
		0\\
		0\\
		0\\
		0\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		-\delta f_u \\
		0\\
		\delta f_u \\
		0 \\
		0 \\
		0 \\
		0\\
		0\\
		0\\
		0\\
		0\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		0 \\
		0\\
		-\sum_X \delta F_u \delta (\vec{x}-\vec{X}) \\
		\delta F_u \\
		0 \\
		0 \\
		0\\
		0\\
		0\\
		0\\
		\delta F_u \text{TIMO}_{\vec{U}}\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		0 \\
		0\\
		0 \\
		\frac{\delta U_M}{\Delta t} \\
		\delta U_M \\
		0 \\
		0\\
		0\\
		0\\
		0\\
		0\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		0 \\
		0\\
		0 \\
		0 \\
		0 \\
		(\vec{u} \cdot \nabla) \delta T_{\text{fluid}} - \frac{\kappa}{\rho c_p} \nabla \cdot \nabla \delta T_{\text{fluid}} \\
		0\\
		0\\
		-\int \delta T_{\text{fluid}} \delta (\vec{x}-\vec{X}) d\Omega\\
		0\\
		0\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		0 \\
		0\\
		0 \\
		0 \\
		0 \\
		-\delta f_{\text{T}_{\text{fluid}}} \\
		\delta f_{\text{T}_{\text{fluid}}}\\
		0\\
		0\\
		0\\
		0\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		0 \\
		0\\
		0 \\
		0 \\
		0 \\
		0 \\
		-\sum_X \delta F_{\text{T}_{\text{fluid}}} \delta (\vec{x}-\vec{X}) \\
		\delta F_{\text{T}_{\text{fluid}}}\\
		0\\
		\delta F_{T_{\text{fluid}}} \text{FOUR}_{T_{\text{structure}}}\\
		0\\
	\end{pmatrix}
	d\Omega \cup X + $\\

	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		0\\
		0\\
		0 \\
		0\\
		0 \\
		0\\
		0\\
		\frac{\delta T_{\text{fluid}_M}}{\Delta t}\\
		\delta T_{\text{fluid}_M}\\
		0\\
		0\\
	\end{pmatrix}
	d\Omega \cup X +$\\
	
		$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		0\\
		0\\
		0\\
		0\\
		0\\
		0\\
		0\\
		-\frac{\delta T_{\text{structure}}}{\Delta t}\\
		0\\
		\delta T_{\text{structure}} \text{FOUR}_{\text{T}_{\text{structure}}}\\
		0\\
	\end{pmatrix}
	d\Omega \cup X + $\\
	
	$\int_{\Omega \cup X}
	\begin{pmatrix}
		\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}} \\ \lambda_{T_{structure}} \\ \lambda_{\vec{U}_{structure}}
	\end{pmatrix}
	\cdot
	\begin{pmatrix}
		0 \\
		0 \\
		0 \\
		-\frac{\delta \vec{U}_{\text{structure}}}{\Delta t}\\
		0 \\
		0 \\
		0 \\
		0 \\
		0 \\
		0 \\
		\delta \vec{U}_{\text{structure}} \text{TIMO}_{\vec{U}}\\
	\end{pmatrix}
	d\Omega \cup X $\\
	
$=0$\\

\newpage
\fontsize{8}{6}
\begin{flushleft}
	Derivation of Immersed Boundary Navier Stokes adjoint
\end{flushleft}
\begin{flushleft}
	$\int_{\Omega \cup X} \lambda \cdot \delta \vec{u} \text{NS}d\Omega \cup X :$
\end{flushleft}
\begin{align*}
	\int_{\Omega \cup X} \lambda_{\vec{u}} \delta \vec{u} \text{NS}_{\text{mom}} d\Omega \cup X = &
	\int_{\Omega \cup X} \lambda_{\vec{u}} \cdot (\vec{u}\cdot\nabla) \delta{\vec{u}} + \lambda_{\vec{u}} \cdot (\delta{\vec{u}}\cdot\nabla)\vec{u}-\lambda_{\vec{u}} \cdot \frac{\mu}{\rho} \Delta \delta{\vec{u}} d\Omega \cup X\\
	=&\int_{\Omega \cup X} - \delta{\vec{u}} \cdot (\vec{u}\cdot\nabla) \lambda_{\vec{u}} - \delta \vec{u} \cdot \left(\nabla \lambda_{\vec{u}} \cdot \vec{u}\right) + \delta{\vec{u}} \cdot \frac{\mu}{\rho} \Delta \lambda_{\vec{u}} d\Omega \cup X +\\
	&\int_{S} \delta \vec{u} \cdot \left(\vec{u}\cdot \vec{n}\right) \lambda_{\vec{u}} + \delta \vec{u} \cdot \left(\vec{u}\cdot \lambda_{\vec{u}}\right)\vec{n} - \frac{\mu}{\rho} \lambda_{\vec{u}} \cdot \left(\nabla \delta \vec{u} \cdot \vec{n}\right) + \frac{\mu}{\rho} \delta \vec{u} \cdot \left(\nabla \lambda_{\vec{u}} \cdot \vec{n}\right) dS\\
	\int_{\Omega \cup X} \lambda_p \delta \vec{u} \text{NS}_{\text{conti}} d\Omega \cup X =&
	\int_{\Omega \cup X} -\lambda_p \nabla \cdot \delta\vec{u} d\Omega \cup X \\
	=&\int_{\Omega \cup X} \nabla\lambda_p  \cdot \delta\vec{u} d\Omega \cup X +\\
	&\int_{S}-\lambda_p \delta\vec{u} \cdot \vec{n} dS\\
	\int_{\Omega \cup X} \lambda_{f_u} \delta \vec{u} \text{NS}_{\text{f}_u} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{F_u} \delta \vec{u} \text{NS}_{\text{F}_u} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{U_M} \delta \vec{u} \text{NS}_{\text{U}_M} d\Omega \cup X =&  - \int_{X} \lambda_{U_M} \int \delta u(\vec{x}) \delta(\vec{x}-\vec{X}) d \Omega dX\\
	=&  \int \delta u(\vec{x}) \int_X -\lambda_{U_M} \delta(\vec{x}-\vec{X}) d \Omega dX\\
	=&  \int \delta u(\vec{x}) \sum_X -\lambda_{U_M} \delta(\vec{x}-\vec{X}) d \Omega dX\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}}} \delta \vec{u} \text{NS}_{\text{T}_{\text{fluid}}} d\Omega \cup X =& \int_{\Omega \cup X} \lambda_{T_{\text{fluid}}} (\delta\vec{u} \cdot \nabla) T_{\text{fluid}} d\Omega \cup X \\
	=& \int_{\Omega \cup X} - (T_{\text{fluid}} \nabla \lambda_{T_{\text{fluid}}}) \cdot \delta \vec{u} d\Omega \cup X +\\
	& \int_{S} T_{\text{fluid}} \lambda_{T_{\text{fluid}}} \delta \vec{u} \cdot \vec{n} dS\\
	\int_{\Omega \cup X} \lambda_{f_{T_{\text{fluid}}}} \delta \vec{u} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{F_{T_{\text{fluid}}}} \delta \vec{u} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}_M}} \delta \vec{u} \text{NS}_{\text{T}_{\text{fluid}_M}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{structure}} \delta \vec{u} \text{FOUR}_{\text{T}_{\text{structure}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{\vec{U}_{structure}} \delta \vec{u} \text{TIMO}_{\vec{U}} d\Omega \cup X =& 0\\
\end{align*}
\begin{align*}
	\int_{\Omega \cup X} \lambda \cdot \delta \vec{u} \text{NS}d\Omega \cup X 
	=& \int_{\Omega \cup X} \delta{\vec{u}} \cdot \left[ -(\vec{u}\cdot\nabla) \lambda_{\vec{u}} - \left(\nabla \lambda_{\vec{u}} \cdot \vec{u}\right) + \frac{\mu}{\rho} \Delta \lambda_{\vec{u}} + \nabla\lambda_p - T_{\text{fluid}} \nabla \lambda_{T_{\text{fluid}}} - \sum_X \lambda_{U_M}(X) \delta(\vec{x}-\vec{X})\right] d\Omega \cup X +\\
	& \int_{S}  \delta \vec{u} \cdot \left[ \left(\vec{u}\cdot \vec{n}\right) \lambda_{\vec{u}} + \left(\vec{u}\cdot \lambda_{\vec{u}}\right)\vec{n} + \frac{\mu}{\rho} \left(\nabla \lambda_{\vec{u}} \cdot \vec{n}\right) -\lambda_p \vec{n} + T_{\text{fluid}} \lambda_{T_{\text{fluid}}} \vec{n} \right] - \frac{\mu}{\rho} \lambda_{\vec{u}} \cdot \left(\nabla \delta \vec{u} \cdot \vec{n}\right)dS
\end{align*}
\noindent\rule[1ex]{\textwidth}{1pt}
\newpage
\begin{flushleft}
	$\int_{\Omega \cup X} \lambda \cdot \delta p \text{NS}d\Omega \cup X:$
\end{flushleft}
\begin{align*}
	\int_{\Omega \cup X} \lambda_{\vec{u}} \delta p \text{NS}_{\text{mom}} d\Omega \cup X  
	=& \int_{\Omega \cup X} \lambda_{\vec{u}} \frac{1}{\rho} \nabla \delta p d\Omega \cup X \\
	=& \int_{\Omega \cup X} - \delta p \frac{1}{\rho} \nabla \cdot \lambda_{\vec{u}} d\Omega \cup X + \\
	 &\int_{S} \delta p \lambda_{\vec{u}} \cdot \vec{n} dS\\
	\int_{\Omega \cup X} \lambda_p \delta p \text{NS}_{\text{conti}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{f_u} \delta p \text{NS}_{\text{f}_u} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{F_u} \delta p \text{NS}_{\text{F}_u} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{U_M} \delta p \text{NS}_{\text{U}_M} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}}} \delta p \text{NS}_{\text{T}_{\text{fluid}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{f_{T_{\text{fluid}}}} \delta p \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{F_{T_{\text{fluid}}}} \delta p \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}_M}} \delta p \text{NS}_{\text{T}_{\text{fluid}_M}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{structure}} \delta p \text{FOUR}_{\text{T}_{\text{structure}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{\vec{U}_{structure}} \delta p \text{TIMO}_{\vec{U}} d\Omega \cup X =& 0\\
\end{align*}
\begin{align*}
	\int_{\Omega \cup X} \lambda \cdot \delta p \text{NS}d\Omega \cup X 
	=&\int_{\Omega \cup X} \delta p \left[ -\frac{1}{\rho} \nabla \cdot \lambda_{\vec{u}}\right] d\Omega \cup X + \\
	&\int_{S} \delta p \lambda_{\vec{u}} \cdot \vec{n} dS
\end{align*}
\noindent\rule[1ex]{\textwidth}{1pt}
\begin{flushleft}
	$\int_{\Omega \cup X} \lambda \cdot \delta f_u \text{NS}d\Omega \cup X :$
\end{flushleft}
\begin{align*}
	\int_{\Omega \cup X} \lambda_{\vec{u}} \delta f_u \text{NS}_{\text{mom}} d\Omega \cup X =& -\int_{\Omega \cup X} \lambda_{\vec{u}} \delta f_u d\Omega \cup X\\
	\int_{\Omega \cup X} \lambda_p \delta f_u \text{NS}_{\text{conti}} d\Omega \cup X  =& 0\\
	\int_{\Omega \cup X} \lambda_{f_u} \delta f_u \text{NS}_{\text{f}_u} d\Omega \cup X =& \int_{\Omega \cup X} \lambda_{f_u} \delta f_u d\Omega \cup X\\
	\int_{\Omega \cup X} \lambda_{F_u} \delta f_u \text{NS}_{\text{F}_u} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{U_M} \delta f_u \text{NS}_{\text{U}_M} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}}} \delta f_u \text{NS}_{\text{T}_{\text{fluid}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{f_{T_{\text{fluid}}}} \delta f_u \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{F_{T_{\text{fluid}}}} \delta f_u \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}_M}} \delta f_u \text{NS}_{\text{T}_{\text{fluid}_M}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{structure}} \delta f_u \text{FOUR}_{\text{T}_{\text{structure}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{\vec{U}_{structure}} \delta f_u \text{TIMO}_{\vec{U}} d\Omega \cup X =& 0\\
\end{align*}
\begin{align*}
	\int_{\Omega \cup X} \lambda \cdot \delta f_u \text{NS}d\Omega \cup X 
	=&\int_{\Omega \cup X} \delta f_u \left[ -\lambda_{\vec{u}} + \lambda_{f_u} \right] d\Omega \cup X\\
\end{align*}
\noindent\rule[1ex]{\textwidth}{1pt}
\newpage
\begin{flushleft}
	$\int_{\Omega \cup X} \lambda \cdot \delta F_u \text{NS}d\Omega \cup X :$
\end{flushleft}
\begin{align*}
	\int_{\Omega \cup X} \lambda_{\vec{u}} \delta F_u \text{NS}_{\text{mom}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_p \delta F_u \text{NS}_{\text{conti}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{f_u} \delta F_u \text{NS}_{\text{f}_u} d\Omega \cup X 
	=& -\int_{\Omega \cup X} \lambda_{f_u} \sum_X \delta F_u \delta (\vec{x}-\vec{X}) d\Omega \cup X\\
	=& \sum_X \delta F_u \int_{\Omega} -\lambda_{f_u} \delta (\vec{x}-\vec{X}) d\Omega\\
	=& \int_X \delta F_u \int_{\Omega} -\lambda_{f_u} \delta (\vec{x}-\vec{X}) d\Omega dX\\
	\int_{\Omega \cup X} \lambda_{F_u} \delta F_u \text{NS}_{\text{F}_u} d\Omega \cup X 
	=& \int_{\Omega \cup X} \lambda_{F_u} \delta F_u d\Omega \cup X\\
	=& \int_{X} \lambda_{F_u} \delta F_u d X\\
	\int_{\Omega \cup X} \lambda_{U_M} \delta F_u \text{NS}_{\text{U}_M} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}}} \delta F_u \text{NS}_{\text{T}_{\text{fluid}}} d\Omega \cup X =&	0\\
	\int_{\Omega \cup X} \lambda_{f_{T_{\text{fluid}}}} \delta F_u \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{F_{T_{\text{fluid}}}} \delta F_u \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}_M}} \delta F_u \text{NS}_{\text{T}_{\text{fluid}_M}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{structure}} \delta F_u \text{FOUR}_{\text{T}_{\text{structure}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{\vec{U}_{structure}} \delta F_u \text{TIMO}_{\vec{U}} d\Omega \cup X =& \int_{\Omega \cup X} \lambda_{\vec{U}_{structure}} \delta F_u \text{TIMO}_{\vec{U}} d\Omega \cup X\\
\end{align*}
\begin{align*}
	\int_{\Omega \cup X} \lambda \cdot \delta f_u \text{NS}d\Omega \cup X 
	=&\int_{X} \delta F_u \left[ \lambda_{F_u} - \int_{\Omega} \lambda_{f_u} \delta (\vec{x}-\vec{X}) d\Omega\right] d X + \int_{\Omega \cup X} \lambda_{\vec{U}_{structure}} \delta F_u \text{TIMO}_{\vec{U}} d\Omega \cup X\\
\end{align*}
\noindent\rule[1ex]{\textwidth}{1pt}
\begin{flushleft}
	$\int_{\Omega \cup X} \lambda \cdot \delta U_M \text{NS}d\Omega \cup X :$
\end{flushleft}
\begin{align*}
	\int_{\Omega \cup X} \lambda_{\vec{u}} \delta U_M \text{NS}_{\text{mom}} d\Omega \cup X =&  0\\
	\int_{\Omega \cup X} \lambda_p \delta U_M \text{NS}_{\text{conti}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{f_u} \delta U_M \text{NS}_{\text{f}_u} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{F_u} \delta U_M \text{NS}_{\text{F}_u} d\Omega \cup X 
	=& \int_{\Omega \cup X}\lambda_{F_u} \frac{\delta U_M}{\Delta t} d\Omega \cup X\\
	=& \int_{X} \delta U_M  \frac{\lambda_{F_u}}{\Delta t} dX\\
	\int_{\Omega \cup X} \lambda_{U_M} \delta U_M \text{NS}_{\text{U}_M} d\Omega \cup X 
	=& \int_{\Omega \cup X} \lambda_{U_M} \delta U_M d\Omega \cup X\\
	=& \int_{X} \lambda_{U_M} \delta U_M d X\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}}} \delta U_M \text{NS}_{\text{T}_{\text{fluid}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{f_{T_{\text{fluid}}}} \delta U_M \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{F_{T_{\text{fluid}}}} \delta U_M \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}_M}} \delta U_M \text{NS}_{\text{T}_{\text{fluid}_M}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{structure}} \delta U_M \text{FOUR}_{\text{T}_{\text{structure}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{\vec{U}_{structure}} \delta U_M \text{TIMO}_{\vec{U}} d\Omega \cup X =& 0\\
\end{align*}
\begin{align*}
	\int_{\Omega \cup X} \lambda \cdot \delta U_M \text{NS}d\Omega \cup X 
	=&\int_{X} \delta U_M \left[ \lambda_{U_M} + \frac{\lambda_{F_u}}{\Delta t} \right] d X\\
\end{align*}
\noindent\rule[1ex]{\textwidth}{1pt}
\begin{flushleft}
	$\int_{\Omega \cup X} \lambda \cdot \delta T_{\text{fluid}} \text{NS}d\Omega \cup X :$
\end{flushleft}
\begin{align*}
	\int_{\Omega \cup X} \lambda_{\vec{u}} \delta T_{\text{fluid}} \text{NS}_{\text{mom}} d\Omega \cup X =&  0\\
	\int_{\Omega \cup X} \lambda_p \delta T_{\text{fluid}} \text{NS}_{\text{conti}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{f_u} \delta T_{\text{fluid}} \text{NS}_{\text{f}_u} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{F_u} \delta T_{\text{fluid}} \text{NS}_{\text{F}_u} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{U_M} \delta T_{\text{fluid}} \text{NS}_{\text{U}_M} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}}} \delta T_{\text{fluid}} \text{NS}_{\text{T}_{\text{fluid}}} d\Omega \cup X 
	=&\int_{\Omega \cup X} \lambda_{T_{\text{fluid}}} (\vec{u} \cdot \nabla) \delta T_{\text{fluid}} - \lambda_{T_{\text{fluid}}} \frac{\kappa}{\rho c_p} \Delta \delta T_{\text{fluid}} d\Omega \cup X\\
	=&\int_{\Omega \cup X} - \delta T_{\text{fluid}} \nabla \lambda_{T_{\text{fluid}}} \cdot \vec{u} + \delta T_{\text{fluid}} \frac{\kappa}{\rho c_p} \Delta  \lambda_{T_{\text{fluid}}} d\Omega \cup X\\
	=&\int_{S} \delta T_{\text{fluid}} \cdot \left(\vec{u}\cdot \vec{n}\right) \lambda_{T_{\text{fluid}}} - \frac{\kappa}{\rho c_p} \lambda_{T_{\text{fluid}}} \cdot \left(\nabla \delta T_{\text{fluid}} \cdot \vec{n}\right) + \frac{\kappa}{\rho c_p} \delta T_{\text{fluid}} \cdot \left(\nabla \lambda_{T_{\text{fluid}}} \cdot \vec{n}\right) dS\\
	\int_{\Omega \cup X} \lambda_{f_{T_{\text{fluid}}}} \delta T_{\text{fluid}} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{F_{T_{\text{fluid}}}} \delta T_{\text{fluid}} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}_M}} \delta T_{\text{fluid}} \text{NS}_{\text{T}_{\text{fluid}_M}} d\Omega \cup X 
	=& \int \delta T_{\text{fluid}} \int_{X} -\lambda_{T_{\text{fluid}_M}} \delta (\vec{x}-\vec{X}) dX d\Omega\\
	=& \int \delta T_{\text{fluid}} \sum_{X} -\lambda_{T_{\text{fluid}_M}} \delta (\vec{x}-\vec{X}) d\Omega\\
	\int_{\Omega \cup X} \lambda_{T_{structure}} \delta T_{\text{fluid}} \text{FOUR}_{\text{T}_{\text{structure}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{\vec{U}_{structure}} \delta T_{\text{fluid}} \text{TIMO}_{\vec{U}} d\Omega \cup X =& 0\\
\end{align*}
\begin{align*}
	\int_{\Omega \cup X} \lambda \cdot \delta T_{\text{fluid}} \text{NS}d\Omega \cup X 
	=&\int_{\Omega \cup X} \delta T_{\text{fluid}} \left[ -\nabla \lambda_{T_{\text{fluid}}} \cdot \vec{u} + \frac{\kappa}{\rho c_p} \Delta  \lambda_{T_{\text{fluid}}} - \sum_{X} \lambda_{T_{\text{fluid}_M}} \delta (\vec{x}-\vec{X})\right] d\Omega \cup X\\
	=&\int_{S} \delta T_{\text{fluid}} \cdot \left[\left(\vec{u}\cdot \vec{n}\right) \lambda_{T_{\text{fluid}}}  + \frac{\kappa}{\rho c_p} \left(\nabla \lambda_{T_{\text{fluid}}} \cdot \vec{n}\right)\right]- \frac{\kappa}{\rho c_p} \lambda_{T_{\text{fluid}}} \cdot \left(\nabla \delta T_{\text{fluid}} \cdot \vec{n}\right) dS\\\\
\end{align*}
\noindent\rule[1ex]{\textwidth}{1pt}
\begin{flushleft}
	$\int_{\Omega \cup X} \lambda \cdot \delta f_{\text{T}_{\text{fluid}}} \text{NS}d\Omega \cup X :$
\end{flushleft}
\begin{align*}
	\int_{\Omega \cup X} \lambda_{\vec{u}} \delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{mom}} d\Omega \cup X =&  0\\
	\int_{\Omega \cup X} \lambda_p \delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{conti}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{f_u} \delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{f}_u} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{F_u} \delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{F}_u} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{U_M} \delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{U}_M} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}}} \delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{T}_{\text{fluid}}} d\Omega \cup X =& \int_{\Omega \cup X} -\lambda_{T_{\text{fluid}}}\delta f_{\text{T}_{\text{fluid}}}d\Omega \cup X\\
	\int_{\Omega \cup X} \lambda_{f_{T_{\text{fluid}}}} \delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} d\Omega \cup X =& \int_{\Omega \cup X} \lambda_{f_{T_{\text{fluid}}}} \delta f_{\text{T}_{\text{fluid}}}d\Omega \cup X\\
	\int_{\Omega \cup X} \lambda_{F_{T_{\text{fluid}}}} \delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}_M}} \delta f_{\text{T}_{\text{fluid}}} \text{NS}_{\text{T}_{\text{fluid}_M}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{structure}} \delta T_{\text{fluid}_M} \text{FOUR}_{\text{T}_{\text{structure}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{\vec{U}_{structure}} \delta T_{\text{fluid}_M} \text{TIMO}_{\vec{U}} d\Omega \cup X =& 0\\
\end{align*}
\begin{align*}
	\int_{\Omega \cup X} \lambda \cdot \delta f_{\text{T}_{\text{fluid}}} \text{NS}d\Omega \cup X 
	=&\int_{\Omega \cup X} \delta f_{\text{T}_{\text{fluid}}} \left[ - \lambda_{T_{\text{fluid}}} +\lambda_{f_{T_{\text{fluid}}}}\right] d\Omega \cup XS\\
\end{align*}
\noindent\rule[1ex]{\textwidth}{1pt}
\begin{flushleft}
	$\int_{\Omega \cup X} \lambda \cdot \delta F_{\text{T}_{\text{fluid}}} \text{NS}d\Omega \cup X :$
\end{flushleft}
\begin{align*}
	\int_{\Omega \cup X} \lambda_{\vec{u}} \delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{mom}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_p \delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{conti}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{f_u} \delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{f}_u} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{F_u} \delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{F}_u} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{U_M} \delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{U}_M} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}}} \delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{T}_{\text{fluid}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{f_{T_{\text{fluid}}}} \delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} d\Omega \cup X 
	=& -\int_{\Omega \cup X} \lambda_{f_{T_{\text{fluid}}}} \sum_X \delta F_{\text{T}_{\text{fluid}}} \delta (\vec{x}-\vec{X}) d\Omega \cup X\\
	=& \sum_X \delta F_{\text{T}_{\text{fluid}}} \int_{\Omega \cup X} -\lambda_{f_{T_{\text{fluid}}}} \delta (\vec{x}-\vec{X}) d\Omega \cup X\\
	=& \int_X \delta F_{\text{T}_{\text{fluid}}} \int_{\Omega} -\lambda_{f_{T_{\text{fluid}}}} \delta (\vec{x}-\vec{X}) d\Omega dX\\
	\int_{\Omega \cup X} \lambda_{F_{T_{\text{fluid}}}} \delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} d\Omega \cup X 
	=& \int_{\Omega \cup X} \lambda_{F_{T_{\text{fluid}}}} \delta F_{\text{T}_{\text{fluid}}} d\Omega \cup X\\
	=& \int_{X} \lambda_{F_{T_{\text{fluid}}}} \delta F_{\text{T}_{\text{fluid}}} d X\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}_M}} \delta F_{\text{T}_{\text{fluid}}} \text{NS}_{\text{T}_{\text{fluid}_M}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{structure}} \delta F_{\text{T}_{\text{fluid}}} \text{FOUR}_{\text{T}_{\text{structure}}} d\Omega \cup X =& \int_{\Omega \cup X} \lambda_{T_{structure}} \delta F_{\text{T}_{\text{fluid}}} \text{FOUR}_{\text{T}_{\text{structure}}} d\Omega \cup X\\
	\int_{\Omega \cup X} \lambda_{\vec{U}_{structure}} \delta F_{\text{T}_{\text{fluid}}} \text{TIMO}_{\vec{U}} d\Omega \cup X =& 0\\
\end{align*}
\begin{align*}
	\int_{\Omega \cup X} \lambda \cdot \delta F_{\text{T}_{\text{fluid}}} \text{NS}d\Omega \cup X 
	=&\int_{X} \delta F_{\text{T}_{\text{fluid}}} \left[ -\int_{\Omega} \lambda_{f_{T_{\text{fluid}}}} \delta (\vec{x}-\vec{X}) d\Omega + \lambda_{F_{T_{\text{fluid}}}}\right] dX + \int_{\Omega \cup X} \lambda_{T_{structure}} \delta F_{\text{T}_{\text{fluid}}} \text{FOUR}_{\text{T}_{\text{structure}}} d\Omega \cup X\\
\end{align*}
\noindent\rule[1ex]{\textwidth}{1pt}
\begin{flushleft}
	$\int_{\Omega \cup X} \lambda \cdot \delta T_{\text{fluid}_M} \text{NS}d\Omega \cup X :$
\end{flushleft}
\begin{align*}
	\int_{\Omega \cup X} \lambda_{\vec{u}} \delta T_{\text{fluid}_M} \text{NS}_{\text{mom}} d\Omega \cup X =&  0\\
	\int_{\Omega \cup X} \lambda_p \delta T_{\text{fluid}_M} \text{NS}_{\text{conti}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{f_u} \delta T_{\text{fluid}_M} \text{NS}_{\text{f}_u} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{F_u} \delta T_{\text{fluid}_M} \text{NS}_{\text{F}_u} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{U_M} \delta T_{\text{fluid}_M} \text{NS}_{\text{U}_M} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}}} \delta T_{\text{fluid}_M} \text{NS}_{\text{T}_{\text{fluid}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{f_{T_{\text{fluid}}}} \delta T_{\text{fluid}_M} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{F_{T_{\text{fluid}}}} \delta T_{\text{fluid}_M} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} d\Omega \cup X 
	=& \int_{\Omega \cup X} \lambda_{F_{T_{\text{fluid}}}} \frac{\delta T_{\text{fluid}_M}}{\Delta t} d\Omega \cup X\\
	=& \int_{\Omega \cup X} \delta T_{\text{fluid}_M}  \frac{\lambda_{F_{T_{\text{fluid}}}}}{\Delta t} d\Omega \cup X\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}_M}} \delta T_{\text{fluid}_M} \text{NS}_{\text{T}_{\text{fluid}_M}} d\Omega \cup X =& \int_{\Omega \cup X} \lambda_{T_{\text{fluid}_M}} \delta T_{\text{fluid}_M} d\Omega \cup X\\
	\int_{\Omega \cup X} \lambda_{T_{structure}} \delta \vec{U}_{\text{structure}} \text{FOUR}_{\text{T}_{\text{structure}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{\vec{U}_{structure}} \delta \vec{U}_{\text{structure}} \text{TIMO}_{\vec{U}} d\Omega \cup X =& 0\\
\end{align*}
\begin{align*}
	\int_{\Omega \cup X} \lambda \cdot \delta T_{\text{fluid}_M} \text{NS}d\Omega \cup X 
	=&\int_{X} \delta T_{\text{fluid}_M} \left[ \lambda_{T_{\text{fluid}_M}} + \frac{\lambda_{F_{T_{\text{fluid}}}}}{\Delta t} \right] d X\\
\end{align*}
\noindent\rule[1ex]{\textwidth}{1pt}
\begin{flushleft}
	$\int_{\Omega \cup X} \lambda \cdot \delta T_{\text{structure}} \text{NS}d\Omega \cup X :$
\end{flushleft}
\begin{align*}
	\int_{\Omega \cup X} \lambda_{\vec{u}} \delta T_{\text{structure}} \text{NS}_{\text{mom}} d\Omega \cup X =&  0\\
	\int_{\Omega \cup X} \lambda_p \delta T_{\text{structure}} \text{NS}_{\text{conti}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{f_u} \delta T_{\text{structure}} \text{NS}_{\text{f}_u} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{F_u} \delta T_{\text{structure}} \text{NS}_{\text{F}_u} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{U_M} \delta T_{\text{structure}} \text{NS}_{\text{U}_M} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}}} \delta T_{\text{structure}} \text{NS}_{\text{T}_{\text{fluid}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{f_{T_{\text{fluid}}}} \delta T_{\text{structure}} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{F_{T_{\text{fluid}}}} \delta T_{\text{structure}} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} d\Omega \cup X 
	=& \int -  \lambda_{F_{T_{\text{fluid}}}} \frac{\delta T_{\text{structure}}}{\Delta t} d\Omega \cup X\\
	=& \int - \delta T_{\text{structure}}\frac{ \lambda_{F_{T_{\text{fluid}}}} }{\Delta t} d\Omega \cup X\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}_M}} \delta T_{\text{structure}} \text{NS}_{\text{T}_{\text{fluid}_M}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{structure}} \delta T_{\text{structure}} \text{FOUR}_{\text{T}_{\text{structure}}} d\Omega \cup X =& \int_{\Omega \cup X} \lambda_{T_{structure}} \delta T_{\text{structure}} \text{FOUR}_{\text{T}_{\text{structure}}} d\Omega \cup X\\
	\int_{\Omega \cup X} \lambda_{\vec{U}_{structure}} \delta T_{\text{structure}} \text{TIMO}_{\vec{U}} d\Omega \cup X =& 0\\
\end{align*}
\begin{align*}
	\int_{\Omega \cup X} \lambda \cdot \delta T_{\text{structure}} \text{NS}d\Omega \cup X 
	=&\int_{X} \delta T_{\text{structure}} \left[ - \frac{\lambda_{F_{T_{\text{fluid}}}}}{\Delta t} \right] d X + \int_{\Omega \cup X} \lambda_{T_{structure}} \delta T_{\text{structure}} \text{FOUR}_{\text{T}_{\text{structure}}} d\Omega \cup X\\
\end{align*}
\noindent\rule[1ex]{\textwidth}{1pt}
\begin{flushleft}
	$\int_{\Omega \cup X} \lambda \cdot \delta \vec{U}_{\text{structure}} \text{NS}d\Omega \cup X :$
\end{flushleft}
\begin{align*}
	\int_{\Omega \cup X} \lambda_{\vec{u}} \delta \vec{U}_{\text{structure}} \text{NS}_{\text{mom}} d\Omega \cup X =&  0\\
	\int_{\Omega \cup X} \lambda_p \delta \vec{U}_{\text{structure}} \text{NS}_{\text{conti}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{f_u} \delta \vec{U}_{\text{structure}} \text{NS}_{\text{f}_u} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{F_u} \delta \vec{U}_{\text{structure}} \text{NS}_{\text{F}_u} d\Omega \cup X 
	=& \int_{\Omega \cup X} -\lambda_{F_u}\frac{\delta \vec{U}_{\text{structure}}}{\Delta t} d \Omega \cup X\\
	=& \int_{\Omega \cup X} -\delta \vec{U}_{\text{structure}}\frac{\lambda_{F_u}}{\Delta t} d \Omega \cup X\\
	\int_{\Omega \cup X} \lambda_{U_M} \delta \vec{U}_{\text{structure}} \text{NS}_{\text{U}_M} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}}} \delta \vec{U}_{\text{structure}} \text{NS}_{\text{T}_{\text{fluid}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{f_{T_{\text{fluid}}}} \delta \vec{U}_{\text{structure}} \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{F_{T_{\text{fluid}}}} \delta \vec{U}_{\text{structure}} \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} d\Omega \cup X 
	=& 0\\
	\int_{\Omega \cup X} \lambda_{T_{\text{fluid}_M}} \delta \vec{U}_{\text{structure}} \text{NS}_{\text{T}_{\text{fluid}_M}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{T_{structure}} \delta \vec{U}_{\text{structure}} \text{FOUR}_{\text{T}_{\text{structure}}} d\Omega \cup X =& 0\\
	\int_{\Omega \cup X} \lambda_{\vec{U}_{structure}} \delta \vec{U}_{\text{structure}} \text{TIMO}_{\vec{U}} d\Omega \cup X =& \int_{\Omega \cup X} \lambda_{\vec{U}_{structure}} \delta \vec{U}_{\text{structure}} \text{TIMO}_{\vec{U}} d\Omega \cup X\\
\end{align*}
\begin{align*}
	\int_{\Omega \cup X} \lambda \cdot \delta \vec{U}_{\text{structure}} \text{NS}d\Omega \cup X 
	=&\int_{X} \delta \vec{U}_{\text{structure}} \left[ - \frac{\lambda_{F_u}}{\Delta t} \right] d X + \int_{\Omega \cup X} \lambda_{\vec{U}_{structure}} \delta \vec{U}_{\text{structure}} \text{TIMO}_{\vec{U}} d\Omega \cup X\\
\end{align*}
\noindent\rule[1ex]{\textwidth}{1pt}
\newpage
\fontsize{10}{8}
\begin{flushleft}
	Adjoint Immersed Boundary Navier Stokes system
\end{flushleft}
	$-(\vec{u}\cdot\nabla) \lambda_{\vec{u}} - \left(\nabla \lambda_{\vec{u}} \cdot \vec{u}\right) + \frac{\mu}{\rho} \Delta \lambda_{\vec{u}} + \nabla\lambda_p - T_{\text{fluid}} \nabla \lambda_{T_{\text{fluid}}} - \sum_X \lambda_{U_M}(X) \delta(\vec{x}-\vec{X}) = 0$ \quad on $\Omega,X$\\
	$-\frac{1}{\rho} \nabla \cdot \lambda_{\vec{u}} = 0$ \quad on $\Omega$\\
	$-\lambda_{\vec{u}} + \lambda_{f_u} = 0$ \quad on $\Omega$\\
	$\lambda_{F_u} - \int_{\Omega} \lambda_{f_u} \delta (\vec{x}-\vec{X}) d\Omega + ... = 0$ \quad on $\Omega,X$\\
	$\lambda_{U_M} + \frac{\lambda_{F_u}}{\Delta t}=0$ \quad on $X$\\
	$-\nabla \lambda_{T_{\text{fluid}}} \cdot \vec{u} + \frac{\kappa}{\rho c_p} \Delta  \lambda_{T_{\text{fluid}}} - \sum_{X} \lambda_{T_{\text{fluid}_M}} \delta (\vec{x}-\vec{X}) = 0$ \quad on $\Omega,X$\\
	$- \lambda_{T_{\text{fluid}}} +\lambda_{f_{T_{\text{fluid}}}} = 0$ \quad on $\Omega$\\
	$-\int_{\Omega} \lambda_{f_{T_{\text{fluid}}}} \delta (\vec{x}-\vec{X}) d\Omega + \lambda_{F_{T_{\text{fluid}}}} + ... = 0$ \quad on $\Omega, X$\\
	$\lambda_{T_{\text{fluid}_M}} + \frac{\lambda_{F_{T_{\text{fluid}}}}}{\Delta t} =0$ \quad on $X$
\begin{flushleft}
	Adjoint Immersed Boundary Navier Stokes system simplified
\end{flushleft}
	$-(\vec{u}\cdot\nabla) \lambda_{\vec{u}} - \left(\nabla \lambda_{\vec{u}} \cdot \vec{u}\right) + \frac{\mu}{\rho} \Delta \lambda_{\vec{u}} + \nabla\lambda_p - T_{\text{fluid}} \nabla \lambda_{T_{\text{fluid}}} - f_{\lambda_{U_M}} = 0$ \quad on $\Omega,X$\\
	$f_{\lambda_{U_M}} - \sum_X \lambda_{U_M}(X) \delta(\vec{x}-\vec{X}) = 0$\\
	$-\frac{1}{\rho} \nabla \cdot \lambda_{\vec{u}} = 0$ \quad on $\Omega$\\
	$-\lambda_{\vec{u}} + \lambda_{f_u} = 0$ \quad on $\Omega$\\
	$\lambda_{F_u} - \int_{\Omega} \lambda_{\vec{u}} \delta (\vec{x}-\vec{X}) d\Omega + ... = 0$ \quad on $\Omega,X$\\
	$\lambda_{U_M} + \frac{\lambda_{F_u}}{\Delta t}=0$ \quad on $X$\\
	$-\nabla \lambda_{T_{\text{fluid}}} \cdot \vec{u} + \frac{\kappa}{\rho c_p} \Delta  \lambda_{T_{\text{fluid}}} - f_{\lambda_{T_{\text{fluid}_M}}} = 0$ \quad on $\Omega,X$\\
	$f_{\lambda_{T_{\text{fluid}_M}}} - \sum_{X} \lambda_{T_{\text{fluid}_M}} \delta (\vec{x}-\vec{X}) = 0$\\
	$- \lambda_{T_{\text{fluid}}} +\lambda_{f_{T_{\text{fluid}}}} = 0$ \quad on $\Omega$\\
	$-\int_{\Omega} \lambda_{T_{\text{fluid}}} \delta (\vec{x}-\vec{X}) d\Omega + \lambda_{F_{T_{\text{fluid}}}} + ... = 0$ \quad on $\Omega, X$\\
	$\lambda_{T_{\text{fluid}_M}} + \frac{\lambda_{F_{T_{\text{fluid}}}}}{\Delta t} =0$ \quad on $X$
\begin{flushleft}
	Adjoint Immersed Boundary Navier Stokes system simplified 2
\end{flushleft}
	$-(\vec{u}\cdot\nabla) \lambda_{\vec{u}} - \left(\nabla \lambda_{\vec{u}} \cdot \vec{u}\right) + \frac{\mu}{\rho} \Delta \lambda_{\vec{u}} + \nabla\lambda_p - T_{\text{fluid}} \nabla \lambda_{T_{\text{fluid}}} - f_{\lambda_{U_M}} = 0$ \quad on $\Omega,X$\\
	$f_{\lambda_{U_M}} - \sum_X \lambda_{U_M}(X) \delta(\vec{x}-\vec{X}) = 0$\\
	$-\frac{1}{\rho} \nabla \cdot \lambda_{\vec{u}} = 0$ \quad on $\Omega$\\
	$\lambda_{F_u} - \int_{\Omega} \lambda_{\vec{u}} \delta (\vec{x}-\vec{X}) d\Omega + ... = 0$ \quad on $\Omega,X$\\
	$\lambda_{U_M} + \frac{\lambda_{F_u}}{\Delta t}=0$ \quad on $X$\\
	$-\nabla \lambda_{T_{\text{fluid}}} \cdot \vec{u} + \frac{\kappa}{\rho c_p} \Delta  \lambda_{T_{\text{fluid}}} - f_{\lambda_{T_{\text{fluid}_M}}} = 0$ \quad on $\Omega,X$\\
	$f_{\lambda_{T_{\text{fluid}_M}}} - \sum_{X} \lambda_{T_{\text{fluid}_M}} \delta (\vec{x}-\vec{X}) = 0$\\
	$-\int_{\Omega} \lambda_{T_{\text{fluid}}} \delta (\vec{x}-\vec{X}) d\Omega + \lambda_{F_{T_{\text{fluid}}}} + ... = 0$ \quad on $\Omega, X$\\
	$\lambda_{T_{\text{fluid}_M}} + \frac{\lambda_{F_{T_{\text{fluid}}}}}{\Delta t} =0$ \quad on $X$
	
	\newpage
\begin{algorithm}[H]
	\SetAlgoLined
	\KwData{$\lambda_{T_{\text{fluid}}}$,$\lambda_{F_{T_{\text{fluid}}}}$,$\lambda_{T_{\text{fluid}_M}}$,$f_{\lambda_{T_{\text{fluid}_M}}}$}
	\For{timestep}
	{
		\While{not converged}
		{
			Solve for $\lambda_{T_{\text{fluid}}}$: $- \frac{\partial \lambda_{T_{\text{fluid}}}}{\partial t} -\vec{u} \cdot \nabla \lambda_{T_{\text{fluid}}} + \frac{\kappa}{\rho c_p} \Delta  \lambda_{T_{\text{fluid}}} = f_{\lambda_{T_{\text{fluid}_M}}} $ \quad on $\Omega$\\
			Compute : $\lambda_{F_{T_{\text{fluid}}}} = \int_{\Omega} \lambda_{T_{\text{fluid}}} \delta (\vec{x}-\vec{X}) d\Omega - ... $ \quad on $X$\\
			Compute : $\lambda_{T_{\text{fluid}_M}} = \frac{... - \lambda_{F_{T_{\text{fluid}}}}}{\Delta t}$ \quad on $X$\\
			Compute : $f_{\lambda_{T_{\text{fluid}_M}}} = \sum_{X} \lambda_{T_{\text{fluid}_M}} \delta (\vec{x}-\vec{X})$ \quad on $\Omega$\\
		}
		\While{not converged}
		{
			Solve for $\lambda_{\vec{u}}$: $ -\frac{\partial \lambda_{\vec{u}}}{\partial t}-(\vec{u}\cdot\nabla) \lambda_{\vec{u}} - \left(\nabla \lambda_{\vec{u}} \cdot \vec{u}\right) + \frac{\mu}{\rho} \Delta \lambda_{\vec{u}} = - \nabla\lambda_p + T_{\text{fluid}} \nabla \lambda_{T_{\text{fluid}}} + f_{\lambda_{U_M}}$ \quad on $\Omega$\\
			Compute : $\lambda_{F_u} = \int_{\Omega} \lambda_{\vec{u}} \delta (\vec{x}-\vec{X}) d\Omega - ...$  \quad on $X$\\
			Compute : $\lambda_{U_M} = \frac{...-\lambda_{F_u}}{\Delta t}$ \quad on $X$\\
			Compute : $f_{\lambda_{U_M}} = \sum_X \lambda_{U_M}(X) \delta(\vec{x}-\vec{X})$ \quad on $\Omega$\\
			Solve for $\lambda_p$: Adjoint pressure correction($-\frac{1}{\rho} \nabla \cdot \lambda_{\vec{u}}=0$)\\
		}
	}
	\caption{Adjoint solution algorithm}
\end{algorithm}

\begin{algorithm}[H]
	\SetAlgoLined
	\KwData{}
	\For{timestep}
	{
		\While{not converged}
		{
			Set: $\text{adjUEqn} = -\frac{\partial \lambda_{\vec{u}}}{\partial t}+(-\vec{\phi}\cdot\nabla) \lambda_{\vec{u}} - \left(\nabla \lambda_{\vec{u}} \cdot \vec{u}\right) + \frac{\mu}{\rho} \Delta \lambda_{\vec{u}}$ \quad on $\Omega$\\
			Compute relaxation(adjUEqn)\\
			Constraint(adjUEqn)\\
			Solve for $\lambda_{\vec{u}}$: $\text{adjUEqn} = - \nabla\lambda_p + T_{\text{fluid}} \nabla \lambda_{T_{\text{fluid}}} + f_{\lambda_{U_M}}$ \quad on $\Omega$\\
			Constrain($\lambda_{\vec{u}}$)\\
			\quad \\
			Set VolScalarField $\text{rAadjU} =  \frac{1}{\text{diag}(\text{adjUEqn})}$\\
			Set VolVectorField $\text{adjHbyA} =  \text{rAadjU}*\text{offDiag}(\text{adjUEqn})$\\
			\quad Set FaceVectorField $\text{adjHbyA}_{\text{flux}} =  \text{Compute flux on faces}(\text{adjHbyA})$\\
			Set FaceScalarField $\text{phiAdjHbyA} = \text{adjHbyA}_{\text{flux}} $\\
			AdjustPhi($\text{phiAdjHbyA}, \lambda_{\vec{u}},\lambda_p$)\\
			
			\While{correctNonOrthogonal}
			{
				Set: $\text{adjpEqn} = \nabla \cdot \left(\text{rAtadjU} \cdot \nabla \lambda_p\right) - \nabla \cdot \text{phiHbyA} $ \quad on $\Omega$\\
				$\text{adjpEqn}.$setReference()\\
				$\text{adjpEqn}.$solve()\\
				
				\If{finalNonOrthogonalIter}
				{
					$\text{adj}\vec{\phi} = \text{phiAdjHbyA} - \text{adjpEqn}$.flux()\\
				}
			}
			Compute relaxation($\lambda_p$)\\
			Compute: $\lambda_{\vec{u}} = \text{adjHbyA} - \text{adjpEqn}$.flux()\\
			CorrectBoundary($\lambda_{\vec{u}}$)\\
			Constrain($\lambda_{\vec{u}}$)
		}
	}
	\caption{OpenFoam adjoint solution base algorithm}
\end{algorithm}

	\newpage
\begin{algorithm}[H]
	\SetAlgoLined
	\KwData{$\lambda_{T_{\text{fluid}}}$,$\lambda_{F_{T_{\text{fluid}}}}$,$\lambda_{T_{\text{fluid}_M}}$,$f_{\lambda_{T_{\text{fluid}_M}}}$}
	\For{timestep}
	{
		\While{not converged}
		{
			Set: $\text{adjTEqn} = - \frac{\partial \lambda_{T_{\text{fluid}}}}{\partial t} -\vec{\phi} \cdot \nabla \lambda_{T_{\text{fluid}}} + \frac{\kappa}{\rho c_p} \Delta  \lambda_{T_{\text{fluid}}}$ \quad on $\Omega$\\
			Solve for $\lambda_{T_{\text{fluid}}}$: $\text{adjTEqn} = f_{\lambda_{T_{\text{fluid}_M}}} $ \quad on $\Omega$\\
			\quad \\
			Compute : $\lambda_{F_{T_{\text{fluid}}}} = \int_{\Omega} \lambda_{T_{\text{fluid}}} \delta (\vec{x}-\vec{X}) d\Omega - ... $ \quad on $X$\\
			Compute : $\lambda_{T_{\text{fluid}_M}} = \frac{... - \lambda_{F_{T_{\text{fluid}}}}}{\Delta t}$ \quad on $X$\\
			Solve adjoint temperature on structure\\
			Compute : $f_{\lambda_{T_{\text{fluid}_M}}} = \sum_{X} \lambda_{T_{\text{fluid}_M}} \delta (\vec{x}-\vec{X})$ \quad on $\Omega$\\
		}
		\While{not converged}
		{
			Set: $\text{adjUEqn} = -\frac{\partial \lambda_{\vec{u}}}{\partial t} + (-\vec{\phi}\cdot\nabla) \lambda_{\vec{u}} - \left(\nabla \lambda_{\vec{u}} \cdot \vec{u}\right) + \frac{\mu}{\rho} \Delta \lambda_{\vec{u}} - T_{\text{fluid}} \nabla \lambda_{T_{\text{fluid}}} - f_{\lambda_{U_M}}$ \quad on $\Omega$\\
			Solve for $\lambda_{\vec{u}}$: $\text{adjUEqn} = - \nabla\lambda_p $ \quad on $\Omega$\\
			\quad \\
			Compute : $\lambda_{F_u} = \int_{\Omega} \lambda_{\vec{u}} \delta (\vec{x}-\vec{X}) d\Omega - ...$  \quad on $X$\\
			Compute : $\lambda_{U_M} = \frac{...-\lambda_{F_u}}{\Delta t}$ \quad on $X$\\
			Solve adjoint structure on structure\\
			Compute : $f_{\lambda_{U_M}} = \sum_X \lambda_{U_M}(X) \delta(\vec{x}-\vec{X})$ \quad on $\Omega$\\
			\quad \\
			\While{pressureCorrection loop}
			{
				Set VolScalarField $\text{rAadjU} =  \frac{1}{\text{diag}(\text{adjUEqn})}$\\
				Set VolVectorField $\text{adjHbyA} =  \text{rAadjU}*\text{offDiag}(\text{adjUEqn})$\\
				ConstrainOnBoundary $(\text{adjHbyA},\lambda_{\vec{u}},\lambda_p)$\\
				\quad Set FaceVectorField $\text{adjHbyA}_{\text{flux}} =  \text{Compute flux on faces}(\text{adjHbyA})$\\
				\quad Set FaceScalarField $\text{rAadjU}_{\text{face}} =  \text{interpolate}(\text{rAadjU})$\\
				Set FaceScalarField $\text{phiAdjHbyA} = \text{adjHbyA}_{\text{flux}} + \text{rAadjU}_{\text{face}}*\text{ddtCorr}(\lambda_{\vec{u}}, \vec{\phi}) $\\
				Set VolScalarField $\text{rAtadjU} = \text{rAadjU}$\\
				\If{pimple.consistent}
				{
					Compute $\text{rAtadjU} =  \frac{1}{max\left[(\frac{1}{\text{rAadjU}}) - \text{offDiag}(\text{adjUEqn})/\text{Vol} , \frac{0.1}{\text{rAadjU}}\right]} $\\
					Compute $\text{phiAdjHbyA} += \text{interpolate}(\text{rAtadjU}-\text{rAadjU})*\text{surfaceGrad}(\lambda_p)*\text{faceVolume}$\\
					Compute $\text{adjHbyA} -=  \left(\text{rAadjU}-\text{rAtadjU}\right)*\text{grad}(\lambda_p)$\\
				}
				ConstrainPressure $(\lambda_p,\lambda_{\vec{u}},\text{phiAdjHbyA},\text{rAtadjU})$\\
				\While{pimple.correctNonOrthogonal}
				{
					Set: $\text{adjpEqn} = \nabla \cdot \left(\text{rAtadjU} \cdot \nabla \vec{u}\right)-\nabla \cdot \text{phiHbyA}$\\
					$\text{adjpEqn}.$setReference()\\
					$\text{adjpEqn}.$solve()\\
				}
				%\If{pimple.consistent}
				%{
				%	$\text{adj}\vec{\phi} = \text{phiAdjHbyA} - \text{adjpEqn}$.flux()\\
				%}
				adj$p.$relax()\\
				Compute: $\lambda_{\vec{u}} = \text{adjHbyA} - \text{rAtadjU}*\text{grad}(\lambda_p)$\\
				CorrectBoundaryConditions($\lambda_{\vec{u}}$)\\
				Constrain($\lambda_{\vec{u}}$)
			}
		}
	}
	\caption{Adjoint solution algorithm}
\end{algorithm}
\newpage
	
\begin{flushleft}
	Adjoint Immersed Boundary Navier Stokes system Solution algorithm
\end{flushleft}


	$-(\vec{u}\cdot\nabla) \lambda_{\vec{u}} - \left(\nabla \lambda_{\vec{u}} \cdot \vec{u}\right) + \frac{\mu}{\rho} \Delta \lambda_{\vec{u}} + \nabla\lambda_p - T_{\text{fluid}} \nabla \lambda_{T_{\text{fluid}}} - f_{\lambda_{U_M}} = 0$ \quad on $\Omega,X$\\
	$f_{\lambda_{U_M}} - \sum_X \lambda_{U_M}(X) \delta(\vec{x}-\vec{X}) = 0$\\
	$-\frac{1}{\rho} \nabla \cdot \lambda_{\vec{u}} = 0$ \quad on $\Omega$\\
	$\lambda_{F_u} - \int_{\Omega} \lambda_{\vec{u}} \delta (\vec{x}-\vec{X}) d\Omega + ... = 0$ \quad on $\Omega,X$\\
	$\lambda_{U_M} + \frac{\lambda_{F_u}}{\Delta t}=0$ \quad on $X$\\
	$-\nabla \lambda_{T_{\text{fluid}}} \cdot \vec{u} + \frac{\kappa}{\rho c_p} \Delta  \lambda_{T_{\text{fluid}}} - f_{\lambda_{T_{\text{fluid}_M}}} = 0$ \quad on $\Omega,X$\\
	$f_{\lambda_{T_{\text{fluid}_M}}} - \sum_{X} \lambda_{T_{\text{fluid}_M}} \delta (\vec{x}-\vec{X}) = 0$\\
	$-\int_{\Omega} \lambda_{T_{\text{fluid}}} \delta (\vec{x}-\vec{X}) d\Omega + \lambda_{F_{T_{\text{fluid}}}} + ... = 0$ \quad on $\Omega, X$\\
	$\lambda_{T_{\text{fluid}_M}} + \frac{\lambda_{F_{T_{\text{fluid}}}}}{\Delta t} =0$ \quad on $X$
	
\begin{flushleft}
	Adjoint Immersed Boundary Navier Stokes system without temperature
\end{flushleft}
	$-(\vec{u}\cdot\nabla) \lambda_{\vec{u}} - \left(\nabla \lambda_{\vec{u}} \cdot \vec{u}\right) + \frac{\mu}{\rho} \Delta \lambda_{\vec{u}} + \nabla\lambda_p - \sum_X \lambda_{U_M}(X) \delta(\vec{x}-\vec{X}) = 0$ \quad on $\Omega,X$\\
	$-\frac{1}{\rho} \nabla \cdot \lambda_{\vec{u}} = 0$ \quad on $\Omega$\\
	$-\lambda_{\vec{u}} + \lambda_{f_u} = 0$ \quad on $\Omega$\\
	$\lambda_{F_u} - \int_{\Omega} \lambda_{f_u} \delta (\vec{x}-\vec{X}) d\Omega = 0$ \quad on $\Omega,X$\\
	$\lambda_{U_M} + \frac{\lambda_{F_u}}{\Delta t}=0$ \quad on $X$\\
	$\rightarrow$\\
	$(\vec{u}\cdot\nabla) \lambda_{\vec{u}} + \left(\nabla \lambda_{\vec{u}} \cdot \vec{u}\right) = \frac{\mu}{\rho} \Delta \lambda_{\vec{u}} + \nabla\lambda_p - \sum_X \lambda_{U_M}(X) \delta(\vec{x}-\vec{X})$ \quad on $\Omega,X$\\
	$-\frac{1}{\rho} \nabla \cdot \lambda_{\vec{u}} = 0$ \quad on $\Omega$\\
	$\lambda_{\vec{u}} = \lambda_{f_u} $ \quad on $\Omega$\\
	$\lambda_{F_u} = \int_{\Omega} \lambda_{f_u} \delta (\vec{x}-\vec{X}) d\Omega$ \quad on $\Omega,X$\\
	$\lambda_{U_M} + \frac{\lambda_{F_u}}{\Delta t}=0$ \quad on $X$\\
\end{center}
\newpage

\begin{center}
\begin{flushleft}
	Immersed Boundary Navier Stokes system sensitivities
\end{flushleft}
$L = J + \int_{\Omega} \vec{\lambda} \cdot \text{NS}(\phi)  d\Omega$\\
$\delta L = \delta_\Gamma L + \delta_\phi L$\\
\begin{flushleft}
	Sensitivities Immersed Boundary Navier Stokes
\end{flushleft}
\begin{flushleft}
	$\delta \Gamma \text{NS}:$
\end{flushleft}
	$\delta \Gamma \text{NS}_{\text{mom}} = 0$\\
	$\delta \Gamma \text{NS}_{\text{conti}} = 0$\\
	$\delta \Gamma \text{NS}_{\text{f}_u} = \sum_X -F_u \delta \Gamma \delta(\vec{x}-\vec{X})$\\
	$\delta \Gamma \text{NS}_{\text{F}_u} = 0$\\
	$\delta \Gamma \text{NS}_{\text{U}_M} = \int -\vec{u} \delta \Gamma \delta (\vec{x}-\vec{X}) d\Omega$\\
	$\delta \Gamma \text{NS}_{\text{T}_{\text{fluid}}} = 0$\\
	$\delta \Gamma \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}} = \sum_X -F_{T_{\text{fluid}}} \delta \Gamma \delta(\vec{x}-\vec{X})$\\
	$\delta \Gamma \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}} = 0$\\
	$\delta \Gamma \text{NS}_{\text{T}_{\text{fluid}_M}} = \int -T_{\text{fluid}} \delta \Gamma \delta (\vec{x}-\vec{X})d\Omega$\\
\end{center}
\begin{center}
$\delta L = \delta_\Gamma J + \int_{\Omega \cup X}
\begin{pmatrix}
	\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}}
\end{pmatrix}
\cdot
\begin{pmatrix}
	\delta \Gamma \text{NS}_{\text{mom}} \\
	\delta \Gamma \text{NS}_{\text{conti}}\\
	\delta \Gamma \text{NS}_{\text{f}_u} \\
	\delta \Gamma \text{NS}_{\text{F}_u} \\
	\delta \Gamma \text{NS}_{\text{U}_M} \\
	\delta \Gamma \text{NS}_{\text{T}_{\text{fluid}}} \\
	\delta \Gamma \text{NS}_{\text{f}_{\text{T}_{\text{fluid}}}}\\
	\delta \Gamma \text{NS}_{\text{F}_{\text{T}_{\text{fluid}}}}\\
	\delta \Gamma \text{NS}_{\text{T}_{\text{fluid}_M}}\\
\end{pmatrix}
d\Omega \cup X =
\delta_\Gamma J + \int_{\Omega \cup X}
\begin{pmatrix}
	\lambda_{\vec{u}} \\ \lambda_p \\ \lambda_{f_u} \\ \lambda_{F_u} \\ \lambda_{U_M}\\ \lambda_{T_{\text{fluid}}} \\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{F_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}}
\end{pmatrix}
\cdot
\begin{pmatrix}
	0\\
	0\\
	\sum_X -F_u \delta \Gamma \delta(\vec{x}-\vec{X}) \\
	0 \\
	\int -\vec{u} \delta \Gamma \delta (\vec{x}-\vec{X})d\Omega \\
	0 \\
	\sum_X -F_{T_{\text{fluid}}} \delta \Gamma \delta(\vec{x}-\vec{X})\\
	0\\
	\int -T_{\text{fluid}} \delta \Gamma \delta (\vec{x}-\vec{X})d\Omega\\
\end{pmatrix}
d\Omega \cup X$\\
$=
\delta_\Gamma J + \int_{\Omega \cup X}
\begin{pmatrix}
	\lambda_{f_u} \\ \lambda_{U_M}\\ \lambda_{f_{T_{\text{fluid}}}} \\ \lambda_{T_{\text{fluid}_M}}
\end{pmatrix}
\cdot
\begin{pmatrix}
	\sum_X -F_u \delta \Gamma \delta(\vec{x}-\vec{X}) \\
	\int -\vec{u} \delta \Gamma \delta (\vec{x}-\vec{X})d\Omega \\
	\sum_X -F_{T_{\text{fluid}}} \delta \Gamma \delta(\vec{x}-\vec{X})\\
	\int -T_{\text{fluid}} \delta \Gamma \delta (\vec{x}-\vec{X})d\Omega\\
\end{pmatrix}
d\Omega \cup X$\\
\begin{align*}
\delta_\Gamma L=
	&\delta_\Gamma J + \\
	&\int_{\Omega}
	\lambda_{f_u} \sum_X -F_u \delta \Gamma \delta(\vec{x}-\vec{X}) + 
	\lambda_{f_{T_{\text{fluid}}}} \sum_X -F_{T_{\text{fluid}}} \delta \Gamma \delta(\vec{x}-\vec{X}) 
	d\Omega + \\
	&\int_X
	\lambda_{U_M} \int -\vec{u} \delta \Gamma \delta (\vec{x}-\vec{X})d\Omega dX + 
	\lambda_{T_{\text{fluid}_M}} \int -T_{\text{fluid}} \delta \Gamma \delta (\vec{x}-\vec{X})d\Omega
	dX
\end{align*}
\begin{align*}
	\delta \Gamma \delta (\vec{x}-\vec{X}) =
	& \delta \Gamma \delta (r = \vert\vert\vec{x}-\vec{X}\vert\vert_2) = \frac{\partial \delta (r = \vert\vert\vec{x}-\vec{X}\vert\vert_2)}{\partial \Gamma} = \frac{\partial \delta}{\partial r}\frac{\partial r}{\partial \vec{X}}\frac{\partial \vec{X}}{\partial \Gamma} \\
\end{align*}
\begin{align*}
	\frac{\partial \vec{X}(s,\alpha)}{\partial \Gamma} = 
	& \frac{\partial}{\partial \Gamma} \left[ \vec{R}_{\text{Nurbs}}(s) + \left(\cos\left(\alpha\right)\vec{d}_1(s)+\sin\left(\alpha\right)\vec{d}_2(s)\right)  r_{\text{Radius}}\left(s,\alpha\right)\right]\\
	& \frac{\partial}{\partial \Gamma} \vec{R}_{\text{Nurbs}}(s) + \frac{\partial}{\partial \Gamma}\left(\cos\left(\alpha\right)\vec{d}_1(s)+\sin\left(\alpha\right)\vec{d}_2(s)\right)  r_{\text{Radius}}\left(s,\alpha\right) + \left(\cos\left(\alpha\right)\vec{d}_1(s)+\sin\left(\alpha\right)\vec{d}_2(s)\right)  \frac{\partial}{\partial \Gamma} r_{\text{Radius}}\left(s,\alpha\right)\\
	& \frac{\partial}{\partial \Gamma} \vec{R}_{\text{Nurbs}}(s) + \left(\cos\left(\alpha\right)\frac{\partial}{\partial \Gamma}\vec{d}_1(s)+\sin\left(\alpha\right)\frac{\partial}{\partial \Gamma}\vec{d}_2(s)\right)  r_{\text{Radius}}\left(s,\alpha\right) + \left(\cos\left(\alpha\right)\vec{d}_1(s)+\sin\left(\alpha\right)\vec{d}_2(s)\right)  \frac{\partial}{\partial \Gamma} r_{\text{Radius}}\left(s,\alpha\right)\\
\end{align*}
with
\begin{align*}
	\vec{d}_3(s) = \frac{\partial}{\partial s} \vec{R}_{\text{Nurbs}}(s) \\
	\vec{d}_2(s) \cdot \vec{d}_3(s) = 0 \\
	\vec{d}_1(s) \cdot \vec{d}_3(s) = 0 \\
	\vec{d}_1(s) \cdot \vec{d}_2(s) = 0 \\
\end{align*}
$\left(\vec{d}_1, \vec{d}_2, \vec{d}_3\right)(\vec{q}) =
\begin{pmatrix}
	1-2(q_2 ^2 + q_3 ^2)   &  -2q_0 q_3 + 2 q_1 q_2  &  2q_0 q_2 + 2q_1 q_3 \\
	  2q_0 q_3 + 2 q_1 q_2 & 1-2(q_1 ^2 + q_3 ^2)    & -2q_0 q_1 + 2 q_2 q_3 \\
	 -2q_0 q_2 + 2 q_1 q_3 &   2q_0 q_1 + 2 q_2 q_3  & 1-2(q_1 ^2 + q_2 ^2) \\
\end{pmatrix}$\\
$\frac{\partial \vec{d}_1}{\partial \vec{q}} = ´
	\begin{pmatrix}
		0      &  0   &  -4q_2  & -4q_3 \\
		2 q_3  & 2q_2 & 2 q_1   & 2q_0  \\
		-2 q_2 & 2q_3 & -2q_0   & 2q_1  \\
	\end{pmatrix}$\\
$\frac{\partial \vec{d}_2}{\partial \vec{q}} = ´
	\begin{pmatrix}
		-2q_3  & 2q_2 &  2q_1   & -2q_0 \\
		 0     & -4q_1&   0     & -4q_3  \\
		 2q_1  & 2q_0 &  2q_3   & 2q_2  \\
	\end{pmatrix}$\\
$\frac{\partial \vec{d}_3}{\partial \vec{q}} = ´
	\begin{pmatrix}
		2q_2 & 2q_3 & 2q_0 & 2q_1 \\
		-2q_1&-2q_0 & 2q_3 & 2q_2 \\
		 0   &-4q_1 &-4q_2 & 0 \\
	\end{pmatrix}$\\
$\vec{q}_{\text{def}} \cdot \vec{q}_{\text{ini}} = 
	\begin{pmatrix}
		q_{0,\text{def}} \\
		q_{1,\text{def}} \\
		q_{2,\text{def}} \\
		q_{3,\text{def}} \\
	\end{pmatrix} 
	\cdot
	\begin{pmatrix}
		q_{0,\text{ini}} \\
		q_{1,\text{ini}} \\
		q_{2,\text{ini}} \\
		q_{3,\text{ini}} \\
	\end{pmatrix}
	= 
	\begin{pmatrix}
		q_{0,\text{def}} q_{0,\text{ini}} - q_{1,\text{def}} q_{1,\text{ini}} - q_{2,\text{def}} q_{2,\text{ini}} - q_{3,\text{def}} q_{3,\text{ini}}\\
		q_{0,\text{def}} q_{1,\text{ini}} + q_{1,\text{def}} q_{0,\text{ini}} + q_{2,\text{def}} q_{3,\text{ini}} - q_{3,\text{def}} q_{2,\text{ini}}\\
		q_{0,\text{def}} q_{2,\text{ini}} - q_{1,\text{def}} q_{3,\text{ini}} + q_{2,\text{def}} q_{0,\text{ini}} + q_{3,\text{def}} q_{1,\text{ini}}\\
		q_{0,\text{def}} q_{3,\text{ini}} + q_{1,\text{def}} q_{2,\text{ini}} - q_{2,\text{def}} q_{1,\text{ini}} + q_{3,\text{def}} q_{0,\text{ini}}\\
	\end{pmatrix}
$\\
$\frac{\partial}{\partial \Gamma}\left(\vec{q}_{\text{def}} \cdot \vec{q}_{\text{ini}}\left(\Gamma\right)\right) =  \frac{\partial}{\partial \Gamma}
\begin{pmatrix}
	q_{0,\text{def}} q_{0,\text{ini}} - q_{1,\text{def}} q_{1,\text{ini}} - q_{2,\text{def}} q_{2,\text{ini}} - q_{3,\text{def}} q_{3,\text{ini}}\\
	q_{0,\text{def}} q_{1,\text{ini}} + q_{1,\text{def}} q_{0,\text{ini}} + q_{2,\text{def}} q_{3,\text{ini}} - q_{3,\text{def}} q_{2,\text{ini}}\\
	q_{0,\text{def}} q_{2,\text{ini}} - q_{1,\text{def}} q_{3,\text{ini}} + q_{2,\text{def}} q_{0,\text{ini}} + q_{3,\text{def}} q_{1,\text{ini}}\\
	q_{0,\text{def}} q_{3,\text{ini}} + q_{1,\text{def}} q_{2,\text{ini}} - q_{2,\text{def}} q_{1,\text{ini}} + q_{3,\text{def}} q_{0,\text{ini}}\\
\end{pmatrix}
=
\begin{pmatrix}
	q_{0,\text{def}} \frac{\partial}{\partial \Gamma}q_{0,\text{ini}} - q_{1,\text{def}} \frac{\partial}{\partial \Gamma}q_{1,\text{ini}} - q_{2,\text{def}} \frac{\partial}{\partial \Gamma}q_{2,\text{ini}} - q_{3,\text{def}} \frac{\partial}{\partial \Gamma}q_{3,\text{ini}}\\
	q_{0,\text{def}} \frac{\partial}{\partial \Gamma}q_{1,\text{ini}} + q_{1,\text{def}} \frac{\partial}{\partial \Gamma}q_{0,\text{ini}} + q_{2,\text{def}} \frac{\partial}{\partial \Gamma}q_{3,\text{ini}} - q_{3,\text{def}} \frac{\partial}{\partial \Gamma}q_{2,\text{ini}}\\
	q_{0,\text{def}} \frac{\partial}{\partial \Gamma}q_{2,\text{ini}} - q_{1,\text{def}} \frac{\partial}{\partial \Gamma}q_{3,\text{ini}} + q_{2,\text{def}} \frac{\partial}{\partial \Gamma}q_{0,\text{ini}} + q_{3,\text{def}} \frac{\partial}{\partial \Gamma}q_{1,\text{ini}}\\
	q_{0,\text{def}} \frac{\partial}{\partial \Gamma}q_{3,\text{ini}} + q_{1,\text{def}} \frac{\partial}{\partial \Gamma}q_{2,\text{ini}} - q_{2,\text{def}} \frac{\partial}{\partial \Gamma}q_{1,\text{ini}} + q_{3,\text{def}} \frac{\partial}{\partial \Gamma}q_{0,\text{ini}}\\
\end{pmatrix}
=
\begin{pmatrix}
	q_{0,\text{def}} \\
	q_{1,\text{def}} \\
	q_{2,\text{def}} \\
	q_{3,\text{def}} \\
\end{pmatrix} 
\cdot
\begin{pmatrix}
	\frac{\partial}{\partial \Gamma} q_{0,\text{ini}} \\
	\frac{\partial}{\partial \Gamma} q_{1,\text{ini}} \\
	\frac{\partial}{\partial \Gamma} q_{2,\text{ini}} \\
	\frac{\partial}{\partial \Gamma} q_{3,\text{ini}} \\
\end{pmatrix}
=
\left(\vec{q}_{\text{def}} \cdot \frac{\partial \vec{q}_{\text{ini}}\left(\Gamma\right)}{\partial \Gamma}\right)
$\\
$\vec{q} \cdot \left(\vec{q}_{\text{ini}}\right)^{-1} = \vec{q}_{\text{def}} \cdot \vec{q}_{\text{ini}}\cdot \left(\vec{q}_{\text{ini}}\right)^{-1} = \vec{q}_{\text{def}} $
\begin{align*}
	\frac{\partial \vec{d}_k(\vec{q} = \vec{q}_{\text{def}} \cdot \vec{q}_{\text{ini}})}{\partial \Gamma}
	&= \frac{\partial \vec{d}_k(\vec{q})}{\partial \vec{q}} \frac{\partial \vec{q}}{\partial \Gamma} \\
	&= \frac{\partial \vec{d}_k(\vec{q})}{\partial \vec{q}} \frac{\partial}{\partial \Gamma}\left(\vec{q}_{\text{def}} \cdot \vec{q}_{\text{ini}}\right)\\
	&= \frac{\partial \vec{d}_k(\vec{q})}{\partial \vec{q}} \left(\vec{q}_{\text{def}} \cdot \frac{\partial \vec{q}_{\text{ini}}\left(\Gamma\right)}{\partial \Gamma}\right)
\end{align*}
\end{center}
\end{document}
